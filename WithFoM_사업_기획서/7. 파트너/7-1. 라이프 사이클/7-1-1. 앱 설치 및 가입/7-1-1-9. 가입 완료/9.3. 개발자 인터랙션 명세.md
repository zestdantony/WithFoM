<!-- WF:DOC=DEV -->
**9.3.** 개발자 인터랙션 명세


**9.3.1.** 가입 완료 처리

1: API 호출 - 가입 완료 확인
　A. 엔드포인트: POST /api/v1/partner/signup/complete
　B. 요청 바디

```json
{
  "user_id": "user_123",
  "store_id": "store_123",
  "contract_id": "contract_123"
}
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 완료 처리 성공 여부 |
| partner_id | string | 생성된 파트너 ID |
| status | string | 파트너 상태 (pending_approval) |
| store_summary | object | 매장 정보 요약 |
| next_steps | array | 다음 단계 안내 |


**9.3.2.** 가입 정보 요약 조회

1: API 호출 - 가입 요약 조회
　A. 엔드포인트: GET /api/v1/partner/{partnerId}/signup-summary
　B. 응답 데이터

```json
{
  "partner_id": "partner_123",
  "store_name": "카페 위드폼",
  "username": "partner123",
  "service_type": "hybrid",
  "registered_at": "2024-01-15T16:00:00Z",
  "status": "pending_approval",
  "estimated_approval_date": "2024-01-17"
}
```


**9.3.3.** 상태 관리

1: 완료 화면 상태

```javascript
const [completionState, setCompletionState] = useState({
  isLoading: true,
  partnerId: null,
  storeSummary: null,
  status: 'pending_approval',
  error: null
});
```

2: 데이터 로딩

```javascript
useEffect(() => {
  const loadCompletionData = async () => {
    try {
      const response = await completeSignup({
        userId: route.params.userId,
        storeId: route.params.storeId,
        contractId: route.params.contractId
      });
      
      setCompletionState({
        isLoading: false,
        partnerId: response.partner_id,
        storeSummary: response.store_summary,
        status: response.status,
        error: null
      });
    } catch (error) {
      setCompletionState(prev => ({
        ...prev,
        isLoading: false,
        error: error.message
      }));
    }
  };
  
  loadCompletionData();
}, []);
```


**9.3.4.** 대시보드 이동 처리

1: 네비게이션 스택 초기화

```javascript
const navigateToDashboard = () => {
  // 가입 플로우 스택 초기화 후 대시보드로 이동
  navigation.reset({
    index: 0,
    routes: [
      {
        name: 'MainTabs',
        state: {
          routes: [{ name: 'Dashboard' }]
        }
      }
    ]
  });
};
```

2: 인증 토큰 저장

```javascript
const saveAuthData = async (partnerId) => {
  await AsyncStorage.setItem('partnerId', partnerId);
  await AsyncStorage.setItem('isLoggedIn', 'true');
  await AsyncStorage.setItem('signupCompleted', 'true');
};
```


**9.3.5.** 푸시 알림 설정 확인

1: 알림 권한 확인

```javascript
import { checkNotifications, requestNotifications } from 'react-native-permissions';

const checkPushPermission = async () => {
  const { status } = await checkNotifications();
  
  if (status !== 'granted') {
    showNotificationPrompt();
  }
};

const requestPushPermission = async () => {
  const { status } = await requestNotifications(['alert', 'sound', 'badge']);
  return status === 'granted';
};
```

2: 알림 권한 요청 팝업

```javascript
const showNotificationPrompt = () => {
  Alert.alert(
    '알림 설정',
    '승인 알림을 받으려면 알림을 허용해주세요',
    [
      { text: '나중에', style: 'cancel' },
      { 
        text: '설정으로 이동', 
        onPress: () => Linking.openSettings() 
      }
    ]
  );
};
```


**9.3.6.** 승인 상태 폴링

1: 승인 상태 확인 (백그라운드)

```javascript
useEffect(() => {
  if (completionState.status === 'pending_approval') {
    const checkApprovalStatus = async () => {
      try {
        const response = await getPartnerStatus(completionState.partnerId);
        
        if (response.status === 'approved') {
          showApprovalNotification();
          setCompletionState(prev => ({ ...prev, status: 'approved' }));
        }
      } catch (error) {
        console.log('Status check failed:', error);
      }
    };
    
    // 30분마다 상태 확인 (앱 포그라운드 시)
    const interval = setInterval(checkApprovalStatus, 30 * 60 * 1000);
    
    return () => clearInterval(interval);
  }
}, [completionState.status]);
```


**9.3.7.** 푸시 알림 처리

1: FCM 토큰 등록

```javascript
import messaging from '@react-native-firebase/messaging';

const registerFCMToken = async (partnerId) => {
  const token = await messaging().getToken();
  
  await registerDeviceToken({
    partner_id: partnerId,
    token: token,
    platform: Platform.OS
  });
};
```

2: 승인 알림 수신 처리

```javascript
messaging().onMessage(async (remoteMessage) => {
  if (remoteMessage.data?.type === 'approval_complete') {
    // 승인 완료 처리
    showLocalNotification({
      title: '가입이 승인되었습니다!',
      body: '지금 바로 서비스를 이용해보세요'
    });
    
    // 상태 업데이트
    setCompletionState(prev => ({ ...prev, status: 'approved' }));
  }
});
```


**9.3.8.** 화면 전환 처리

1: 완료 애니메이션

```javascript
import LottieView from 'lottie-react-native';

const CompletionAnimation = () => (
  <LottieView
    source={require('./animations/celebration.json')}
    autoPlay
    loop={false}
    style={styles.animation}
  />
);
```

2: 대시보드 전환 애니메이션

```javascript
const screenOptions = {
  cardStyleInterpolator: CardStyleInterpolators.forFadeFromBottomAndroid,
  transitionSpec: {
    open: { animation: 'timing', config: { duration: 400 } },
    close: { animation: 'timing', config: { duration: 400 } }
  }
};
```


**9.3.9.** 에러 처리

1: 에러 코드 매핑

| 에러 코드 | 설명 | 사용자 메시지 |
|---|---|---|
| COMPLETE_001 | 가입 완료 처리 실패 | 가입 완료 처리에 실패했습니다 |
| COMPLETE_002 | 토큰 저장 실패 | 로그인 정보 저장에 실패했습니다 |
| COMPLETE_003 | FCM 등록 실패 | 알림 설정에 실패했습니다 |

2: 에러 핸들링

```javascript
const handleError = (error) => {
  const errorMessages = {
    'COMPLETE_001': '가입 완료 처리에 실패했습니다. 다시 시도해주세요',
    'COMPLETE_002': '로그인 정보 저장에 실패했습니다',
    'COMPLETE_003': '알림 설정에 실패했습니다. 나중에 설정에서 변경할 수 있습니다'
  };
  
  showToast(errorMessages[error.code] || '오류가 발생했습니다');
  logError(error, 'signup_complete');
};
```


**9.3.10.** 접근성 요구사항

1: 완료 메시지 접근성

```javascript
<View
  accessible
  accessibilityRole="alert"
  accessibilityLabel="가입이 완료되었습니다. 위드폼 파트너가 되신 것을 환영합니다."
>
  <LottieView source={celebrationAnimation} />
  <Text style={styles.title}>가입이 완료되었습니다!</Text>
  <Text style={styles.subtitle}>위드폼 파트너가 되신 것을 환영합니다</Text>
</View>
```

2: 버튼 접근성

```javascript
<TouchableOpacity
  accessibilityLabel="대시보드로 이동"
  accessibilityHint="파트너 대시보드 홈 화면으로 이동합니다"
  accessibilityRole="button"
  onPress={navigateToDashboard}
>
  <Text>대시보드로 이동</Text>
</TouchableOpacity>
```


• 참조: 7-2-2. 홈 메인 화면(대시보드)
