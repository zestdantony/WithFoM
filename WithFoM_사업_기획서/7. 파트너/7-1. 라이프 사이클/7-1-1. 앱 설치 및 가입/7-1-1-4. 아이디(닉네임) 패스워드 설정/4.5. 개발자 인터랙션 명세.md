**4.5.** 개발자 인터랙션 명세


**4.5.1.** 아이디 유효성 검사

1: 클라이언트 측 유효성 검사

```javascript
const validateUsername = (username) => {
  const rules = {
    minLength: 4,
    maxLength: 20,
    pattern: /^[a-zA-Z0-9]+$/
  };
  
  if (username.length < rules.minLength) {
    return { valid: false, message: '아이디는 4자 이상이어야 합니다' };
  }
  if (username.length > rules.maxLength) {
    return { valid: false, message: '아이디는 20자 이하이어야 합니다' };
  }
  if (!rules.pattern.test(username)) {
    return { valid: false, message: '영문, 숫자만 사용 가능합니다' };
  }
  return { valid: true, message: '' };
};
```

2: API 호출 - 아이디 중복 확인
　A. 엔드포인트: GET /api/v1/auth/check-username
　B. 요청 파라미터

| 파라미터 | 타입 | 설명 |
|---|---|---|
| username | string | 확인할 아이디 |

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| available | boolean | 사용 가능 여부 |
| message | string | 결과 메시지 |


**4.5.2.** 비밀번호 유효성 검사

1: 비밀번호 규칙 검사

```javascript
const validatePassword = (password) => {
  const hasUpperCase = /[A-Z]/.test(password);
  const hasLowerCase = /[a-z]/.test(password);
  const hasNumbers = /\d/.test(password);
  const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
  const isMinLength = password.length >= 8;
  
  const typesCount = [hasUpperCase, hasLowerCase, hasNumbers, hasSpecialChar]
    .filter(Boolean).length;
  
  if (!isMinLength) {
    return { valid: false, strength: 'weak', message: '8자 이상 입력해주세요' };
  }
  if (typesCount < 2) {
    return { valid: false, strength: 'weak', message: '영문 대/소문자, 숫자, 특수문자 중 2가지 이상 조합해주세요' };
  }
  if (typesCount === 2) {
    return { valid: true, strength: 'medium', message: '보통 강도의 비밀번호입니다' };
  }
  return { valid: true, strength: 'strong', message: '강력한 비밀번호입니다' };
};
```

2: 비밀번호 확인 일치 검사

```javascript
const validatePasswordConfirm = (password, confirmPassword) => {
  if (confirmPassword === '') {
    return { valid: false, message: '' };
  }
  if (password !== confirmPassword) {
    return { valid: false, message: '비밀번호가 일치하지 않습니다' };
  }
  return { valid: true, message: '비밀번호가 일치합니다' };
};
```


**4.5.3.** 계정 정보 제출

1: API 호출 - 계정 생성
　A. 엔드포인트: POST /api/v1/auth/register
　B. 요청 바디

```json
{
  "session_token": "token_from_terms_agreement",
  "username": "partner123",
  "password": "SecurePassword123!",
  "verified_info": {
    "name": "홍길동",
    "phone": "010-1234-5678",
    "ci": "ci_value",
    "di": "di_value"
  }
}
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 생성 성공 여부 |
| user_id | string | 생성된 사용자 ID |
| next_step | string | 다음 단계 정보 |


**4.5.4.** 상태 관리

1: 입력 상태 관리

```javascript
const [formState, setFormState] = useState({
  username: '',
  usernameChecked: false,
  usernameAvailable: false,
  password: '',
  passwordStrength: 'weak',
  passwordConfirm: '',
  passwordMatch: false
});

const [isSubmitting, setIsSubmitting] = useState(false);
```

2: 버튼 활성화 조건

```javascript
const isFormValid = () => {
  return (
    formState.usernameChecked &&
    formState.usernameAvailable &&
    formState.passwordStrength !== 'weak' &&
    formState.passwordMatch
  );
};
```


**4.5.5.** 화면 전환 처리

1: 다음 단계로 이동

```javascript
const handleSubmit = async () => {
  if (!isFormValid()) {
    showIncompleteFieldsToast();
    return;
  }
  
  setIsSubmitting(true);
  
  try {
    const response = await registerAccount({
      username: formState.username,
      password: formState.password,
      sessionToken: route.params.sessionToken,
      verifiedInfo: route.params.verifiedInfo
    });
    
    if (response.success) {
      navigation.navigate('StoreBasicInfo', {
        userId: response.user_id,
        username: formState.username
      });
    }
  } catch (error) {
    handleError(error);
  } finally {
    setIsSubmitting(false);
  }
};
```

2: 미완료 항목 안내

```javascript
const showIncompleteFieldsToast = () => {
  if (!formState.usernameChecked) {
    showToast('아이디 중복 확인을 해주세요');
  } else if (!formState.usernameAvailable) {
    showToast('사용 가능한 아이디를 입력해주세요');
  } else if (formState.passwordStrength === 'weak') {
    showToast('비밀번호를 강화해주세요');
  } else if (!formState.passwordMatch) {
    showToast('비밀번호 확인이 일치하지 않습니다');
  }
};
```


**4.5.6.** 에러 처리

1: 에러 코드 매핑

| 에러 코드 | 설명 | 사용자 메시지 |
|---|---|---|
| ACC_001 | 아이디 중복 | 이미 사용 중인 아이디입니다 |
| ACC_002 | 비밀번호 약함 | 비밀번호를 강화해주세요 |
| ACC_003 | 세션 만료 | 다시 시작해주세요 |
| ACC_004 | 서버 오류 | 잠시 후 다시 시도해주세요 |

2: 에러 핸들링

```javascript
const handleError = (error) => {
  const errorMessages = {
    'ACC_001': '이미 사용 중인 아이디입니다',
    'ACC_002': '비밀번호를 강화해주세요',
    'ACC_003': '세션이 만료되었습니다. 처음부터 다시 시작해주세요',
    'ACC_004': '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요'
  };
  
  showToast(errorMessages[error.code] || '오류가 발생했습니다');
  
  if (error.code === 'ACC_003') {
    navigation.reset({
      index: 0,
      routes: [{ name: 'TermsAgreement' }]
    });
  }
  
  logError(error, 'account_setup');
};
```


**4.5.7.** 비밀번호 보안

1: 비밀번호 필드 보안

```javascript
<TextInput
  secureTextEntry={!showPassword}
  autoComplete="off"
  autoCorrect={false}
  textContentType="oneTimeCode" // iOS 자동완성 방지
/>
```

2: 비밀번호 해싱 (서버 전송 전 - 선택적)

```javascript
// 클라이언트에서 해싱하는 경우 (서버에서 추가 해싱 필요)
import { hash } from 'bcryptjs';

const hashPassword = async (password) => {
  const salt = await genSalt(10);
  return await hash(password, salt);
};
```


**4.5.8.** 접근성 요구사항

1: 입력 필드 접근성

```javascript
<TextInput
  accessibilityLabel="아이디 입력"
  accessibilityHint="영문과 숫자 조합으로 4-20자 입력하세요"
  accessibilityState={{ 
    invalid: !formState.usernameAvailable && formState.usernameChecked 
  }}
/>
```

2: 비밀번호 강도 접근성

```javascript
<View
  accessibilityLabel={`비밀번호 강도: ${strengthLabels[formState.passwordStrength]}`}
  accessibilityRole="progressbar"
  accessibilityValue={{
    min: 0,
    max: 100,
    now: strengthValues[formState.passwordStrength]
  }}
/>
```

3: 에러 메시지 알림

```javascript
<Text
  accessibilityRole="alert"
  accessibilityLiveRegion="polite"
>
  {errorMessage}
</Text>
```


**4.5.9.** 키보드 관리

1: 키보드 이벤트 처리

```javascript
import { KeyboardAvoidingView, Platform } from 'react-native';

<KeyboardAvoidingView
  behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
  keyboardVerticalOffset={100}
>
  {/* 입력 폼 */}
</KeyboardAvoidingView>
```

2: 입력 필드 포커스 관리

```javascript
const usernameRef = useRef();
const passwordRef = useRef();
const confirmRef = useRef();

// 아이디 입력 후 Return 키
<TextInput
  ref={usernameRef}
  returnKeyType="next"
  onSubmitEditing={() => passwordRef.current?.focus()}
/>
```


• 참조: 7-1-1-5. 매장 기본 정보 입력
