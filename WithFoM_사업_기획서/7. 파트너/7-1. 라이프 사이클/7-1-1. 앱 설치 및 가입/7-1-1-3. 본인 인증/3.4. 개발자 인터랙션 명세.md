<!-- WF:DOC=DEV -->
**3.4.** 개발자 인터랙션 명세


**3.4.1.** 본인 인증 서비스 연동

1: 인증 서비스 제공업체
　A. 휴대폰 인증: NICE 평가정보 또는 KMC (한국모바일인증)
　B. 공동인증서: 금융결제원 공동인증서
　C. 간편인증: 카카오, 네이버, PASS

2: SDK 초기화

```javascript
// NICE 본인인증 SDK 초기화
import NiceAuth from 'nice-auth-sdk';

const initNiceAuth = () => {
  NiceAuth.init({
    clientId: process.env.NICE_CLIENT_ID,
    serviceType: 'mobile',
    callback: handleAuthResult
  });
};
```


**3.4.2.** 휴대폰 인증 처리

1: API 호출 - 인증번호 요청
　A. 엔드포인트: POST /api/v1/auth/phone/request
　B. 요청 바디

```json
{
  "carrier": "SKT",
  "name": "홍길동",
  "birth_date": "1990-01-01",
  "gender": "M",
  "phone_number": "010-1234-5678"
}
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| request_id | string | 인증 요청 고유 ID |
| expires_at | string | 인증번호 만료 시간 (ISO 8601) |
| retry_count | number | 남은 재시도 횟수 |

2: API 호출 - 인증번호 확인
　A. 엔드포인트: POST /api/v1/auth/phone/verify
　B. 요청 바디

```json
{
  "request_id": "req_abc123",
  "auth_code": "123456"
}
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 인증 성공 여부 |
| verified_name | string | 인증된 이름 |
| verified_phone | string | 인증된 휴대폰 번호 |
| verified_birth | string | 인증된 생년월일 |
| ci | string | 연계정보 (CI) |
| di | string | 중복가입확인정보 (DI) |


**3.4.3.** 공동인증서 인증 처리

1: 인증서 목록 조회

```javascript
const getCertificateList = async () => {
  const certificates = await CertModule.getInstalledCertificates();
  return certificates.map(cert => ({
    id: cert.id,
    subject: cert.subject,
    issuer: cert.issuer,
    expiryDate: cert.notAfter,
    type: cert.type // 개인/범용
  }));
};
```

2: 인증서 검증

```javascript
const verifyCertificate = async (certId, password) => {
  try {
    const result = await CertModule.verify(certId, password);
    return {
      success: true,
      name: result.subject.CN,
      ci: result.ci,
      di: result.di
    };
  } catch (error) {
    return {
      success: false,
      error: error.code
    };
  }
};
```


**3.4.4.** 간편인증 처리

1: 카카오 인증 호출

```javascript
const requestKakaoAuth = async () => {
  try {
    const result = await KakaoAuth.requestVerification({
      txId: generateTxId(),
      targetInfo: {
        name: inputName,
        phoneNo: inputPhone
      }
    });
    return handleAuthResult(result);
  } catch (error) {
    handleAuthError(error);
  }
};
```

2: 네이버 인증 호출

```javascript
const requestNaverAuth = async () => {
  try {
    const result = await NaverAuth.requestCertification({
      clientId: process.env.NAVER_CLIENT_ID,
      returnUrl: 'withfom://auth/callback'
    });
    return handleAuthResult(result);
  } catch (error) {
    handleAuthError(error);
  }
};
```

3: PASS 인증 호출

```javascript
const requestPassAuth = async () => {
  try {
    const result = await PassAuth.authenticate({
      serviceId: process.env.PASS_SERVICE_ID,
      callbackUrl: 'withfom://auth/callback'
    });
    return handleAuthResult(result);
  } catch (error) {
    handleAuthError(error);
  }
};
```


**3.4.5.** 인증 결과 처리

1: 인증 성공 시 데이터 저장

```javascript
const handleAuthSuccess = async (authResult) => {
  // 인증 정보 임시 저장 (세션 스토리지)
  await AsyncStorage.setItem('auth_session', JSON.stringify({
    name: authResult.verified_name,
    phone: authResult.verified_phone,
    birth: authResult.verified_birth,
    ci: authResult.ci,
    di: authResult.di,
    verified_at: new Date().toISOString()
  }));
  
  // 다음 화면으로 이동
  navigation.navigate('AccountSetup', {
    verifiedName: authResult.verified_name,
    verifiedPhone: authResult.verified_phone
  });
};
```

2: 인증 실패 시 처리

```javascript
const handleAuthFailure = (error) => {
  const errorMessages = {
    'INVALID_CODE': '인증번호가 일치하지 않습니다',
    'EXPIRED': '인증 시간이 초과되었습니다',
    'MAX_RETRY': '인증 시도 횟수를 초과했습니다',
    'NETWORK_ERROR': '네트워크 오류가 발생했습니다',
    'USER_CANCEL': '인증이 취소되었습니다'
  };
  
  showToast(errorMessages[error.code] || '인증에 실패했습니다');
  logError(error, 'identity_verification');
};
```


**3.4.6.** 타이머 관리

1: 인증번호 유효 시간 타이머

```javascript
const [remainingTime, setRemainingTime] = useState(180); // 3분

useEffect(() => {
  if (remainingTime <= 0) {
    setIsTimerExpired(true);
    return;
  }
  
  const timer = setInterval(() => {
    setRemainingTime(prev => prev - 1);
  }, 1000);
  
  return () => clearInterval(timer);
}, [remainingTime]);

const formatTime = (seconds) => {
  const min = Math.floor(seconds / 60);
  const sec = seconds % 60;
  return `${min}:${sec.toString().padStart(2, '0')}`;
};
```


**3.4.7.** 화면 전환 처리

1: 네비게이션 스택

| 화면 | 라우트명 | 설명 |
|---|---|---|
| 인증 방법 선택 | AuthMethodSelect | 인증 방법 선택 화면 |
| 휴대폰 인증 | PhoneAuth | 휴대폰 인증 입력 화면 |
| 공동인증서 인증 | CertAuth | 공동인증서 인증 화면 |
| 인증 완료 | AuthComplete | 인증 완료 확인 화면 |

2: 화면 전환 로직

```javascript
const handleAuthMethodSelect = (method) => {
  switch (method) {
    case 'phone':
      navigation.navigate('PhoneAuth');
      break;
    case 'cert':
      navigation.navigate('CertAuth');
      break;
    case 'kakao':
    case 'naver':
    case 'pass':
      requestSimpleAuth(method);
      break;
  }
};
```


**3.4.8.** 에러 처리

1: 네트워크 오류

```javascript
const handleNetworkError = () => {
  showModal({
    title: '네트워크 오류',
    message: '네트워크 연결을 확인해주세요',
    buttons: [
      { text: '다시 시도', onPress: retryRequest },
      { text: '취소', onPress: closeModal }
    ]
  });
};
```

2: 에러 코드 매핑

| 에러 코드 | 설명 | 사용자 메시지 |
|---|---|---|
| AUTH_001 | 인증번호 불일치 | 인증번호가 일치하지 않습니다 |
| AUTH_002 | 인증 시간 초과 | 인증 시간이 초과되었습니다 |
| AUTH_003 | 최대 시도 횟수 초과 | 잠시 후 다시 시도해주세요 |
| AUTH_004 | 통신사 정보 불일치 | 통신사 정보를 확인해주세요 |
| AUTH_005 | 이름 불일치 | 입력하신 정보를 확인해주세요 |


**3.4.9.** 접근성 요구사항

1: 스크린 리더 지원
　A. 인증 방법 버튼에 적절한 접근성 라벨 적용
　B. 타이머 상태 알림: "남은 시간 2분 30초"
　C. 인증 결과 알림: "본인 인증이 완료되었습니다"

2: 접근성 라벨 예시

```javascript
<TouchableOpacity
  accessibilityLabel="휴대폰 인증"
  accessibilityHint="휴대폰 번호로 본인 인증을 진행합니다"
  accessibilityRole="button"
  onPress={() => handleAuthMethodSelect('phone')}
>
  <Text>휴대폰 인증</Text>
</TouchableOpacity>
```

3: 입력 필드 접근성

```javascript
<TextInput
  accessibilityLabel="인증번호 입력"
  accessibilityHint="SMS로 받은 6자리 인증번호를 입력하세요"
  keyboardType="number-pad"
  maxLength={6}
/>
```


• 참조: 7-1-1-4. 아이디(닉네임) 패스워드 설정
