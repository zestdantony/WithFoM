<!-- WF:DOC=DEV -->
**8.5.** 개발자 인터랙션 명세


**8.5.1.** 계약서 생성 API

**8.5.1.1.** API 호출 - 계약서 생성
　1: 엔드포인트: POST /api/v1/contract/generate
　2: 요청 바디

```json
{
  "store_id": "store_123",
  "user_id": "user_123"
}
```

　3: 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| contract_id | string | 계약서 고유 ID |
| content_html | string | 계약서 HTML 내용 |
| partner_info | object | 반영된 파트너 정보 |
| store_info | object | 반영된 매장 정보 |
| created_at | string | 생성 일시 |


**8.5.2.** 서명 처리

**8.5.2.1.** 직접 서명 캔버스

```javascript
import SignatureCanvas from 'react-native-signature-canvas';

const SignaturePad = ({ onComplete }) => {
  const signatureRef = useRef();
  
  const handleClear = () => {
    signatureRef.current?.clearSignature();
  };
  
  const handleConfirm = () => {
    signatureRef.current?.readSignature();
  };
  
  return (
    <View style={styles.container}>
      <SignatureCanvas
        ref={signatureRef}
        onOK={(signature) => onComplete(signature)} // base64 이미지
        webStyle={`.m-signature-pad { box-shadow: none; border: 1px solid #ccc; }`}
        autoClear={false}
        backgroundColor="white"
        penColor="black"
      />
      <View style={styles.buttons}>
        <Button title="다시 쓰기" onPress={handleClear} />
        <Button title="확인" onPress={handleConfirm} />
      </View>
    </View>
  );
};
```

**8.5.2.2.** 전자서명 연동

```javascript
const handleElectronicSignature = async (method) => {
  try {
    let signatureData;
    
    switch (method) {
      case 'certificate':
        signatureData = await requestCertificateSignature(contractId);
        break;
      case 'kakao':
        signatureData = await requestKakaoSignature(contractId);
        break;
      case 'naver':
        signatureData = await requestNaverSignature(contractId);
        break;
      case 'pass':
        signatureData = await requestPassSignature(contractId);
        break;
    }
    
    return signatureData;
  } catch (error) {
    handleSignatureError(error);
  }
};
```


**8.5.3.** 서명 저장 API

**8.5.3.1.** API 호출 - 서명 저장
　1: 엔드포인트: POST /api/v1/contract/{contractId}/sign
　2: 요청 바디

```json
{
  "signature_type": "direct",
  "signature_data": "base64_encoded_signature_image",
  "signed_at": "2024-01-15T15:30:00Z",
  "device_info": {
    "os": "iOS",
    "os_version": "17.0",
    "app_version": "1.0.0",
    "device_id": "device_uuid"
  }
}
```

　3: 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 서명 저장 성공 여부 |
| signed_contract_url | string | 서명된 계약서 URL |
| pdf_url | string | PDF 다운로드 URL |


**8.5.4.** 계약서 다운로드 처리

**8.5.4.1.** PDF 다운로드

```javascript
import RNFetchBlob from 'rn-fetch-blob';

const downloadContract = async (pdfUrl, fileName) => {
  try {
    const { dirs } = RNFetchBlob.fs;
    const filePath = `${dirs.DownloadDir}/${fileName}`;
    
    const response = await RNFetchBlob.config({
      fileCache: true,
      path: filePath,
      addAndroidDownloads: {
        useDownloadManager: true,
        notification: true,
        title: fileName,
        description: '계약서 다운로드 중...',
        mime: 'application/pdf'
      }
    }).fetch('GET', pdfUrl);
    
    showToast('계약서가 다운로드되었습니다');
    return response.path();
  } catch (error) {
    showToast('다운로드에 실패했습니다');
    logError(error, 'contract_download');
  }
};
```


**8.5.5.** 이메일 발송 처리

**8.5.5.1.** API 호출 - 이메일 발송
　1: 엔드포인트: POST /api/v1/contract/{contractId}/send-email
　2: 요청 바디

```json
{
  "email": "partner@example.com",
  "resend": false
}
```

　3: 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 발송 성공 여부 |
| sent_at | string | 발송 일시 |


**8.5.6.** 상태 관리

**8.5.6.1.** 계약서 상태

```javascript
const [contractState, setContractState] = useState({
  status: 'loading', // loading, ready, signing, signed
  contractId: null,
  contractContent: null,
  signatureData: null,
  signedAt: null,
  pdfUrl: null,
  emailSent: false
});
```

**8.5.6.2.** 상태별 UI

```javascript
const renderContractStatus = () => {
  switch (contractState.status) {
    case 'loading':
      return <LoadingSpinner message="계약서를 생성 중입니다..." />;
    case 'ready':
      return (
        <>
          <ContractViewer content={contractState.contractContent} />
          <Button title="서명하기" onPress={openSignaturePad} />
        </>
      );
    case 'signing':
      return <SignaturePad onComplete={handleSignatureComplete} />;
    case 'signed':
      return (
        <>
          <ContractViewer content={contractState.contractContent} signed />
          <Button title="계약서 다운로드" onPress={handleDownload} />
          <Button title="이메일로 받기" onPress={handleEmailSend} />
          <Button title="다음" onPress={handleNext} />
        </>
      );
  }
};
```


**8.5.7.** 화면 전환 처리

**8.5.7.1.** 다음 단계로 이동

```javascript
const handleNext = async () => {
  if (contractState.status !== 'signed') {
    showToast('서명을 완료해주세요');
    return;
  }
  
  try {
    await finalizeContract(contractState.contractId);
    
    navigation.navigate('SignupComplete', {
      storeId: route.params.storeId,
      contractId: contractState.contractId
    });
  } catch (error) {
    handleError(error);
  }
};
```


**8.5.8.** 에러 처리

**8.5.8.1.** 에러 코드 매핑

| 에러 코드 | 설명 | 사용자 메시지 |
|---|---|---|
| CONTRACT_001 | 계약서 생성 실패 | 계약서 생성에 실패했습니다 |
| CONTRACT_002 | 서명 저장 실패 | 서명 저장에 실패했습니다 |
| CONTRACT_003 | PDF 생성 실패 | PDF 생성에 실패했습니다 |
| CONTRACT_004 | 이메일 발송 실패 | 이메일 발송에 실패했습니다 |

**8.5.8.2.** 에러 핸들링

```javascript
const handleError = (error) => {
  const errorMessages = {
    'CONTRACT_001': '계약서 생성에 실패했습니다. 다시 시도해주세요',
    'CONTRACT_002': '서명 저장에 실패했습니다. 다시 시도해주세요',
    'CONTRACT_003': 'PDF 생성에 실패했습니다. 다시 시도해주세요',
    'CONTRACT_004': '이메일 발송에 실패했습니다. 다시 시도해주세요'
  };
  
  showToast(errorMessages[error.code] || '오류가 발생했습니다');
  logError(error, 'contract');
};
```


**8.5.9.** 접근성 요구사항

**8.5.9.1.** 계약서 읽기 접근성

```javascript
<ScrollView
  accessibilityLabel="파트너 계약서"
  accessibilityHint="스크롤하여 계약서 전체 내용을 확인하세요"
>
  <View accessible accessibilityRole="article">
    {/* 계약서 내용 */}
  </View>
</ScrollView>
```

**8.5.9.2.** 서명 영역 접근성

```javascript
<View
  accessible
  accessibilityLabel="서명 입력 영역"
  accessibilityHint="손가락으로 서명을 그려주세요"
  accessibilityRole="none"
>
  <SignatureCanvas />
</View>
```


• 참조: 7-1-1-9. 가입 완료
