<!-- WF:DOC=DEV -->
**6.5.** 개발자 인터랙션 명세


**6.5.1.** 국세청 API 연동

1: API 호출 - 사업자 진위 확인
　A. 엔드포인트: POST /api/v1/business/verify
　B. 요청 바디

```json
{
  "business_number": "1234567890"
}
```

　C. 응답 데이터 (성공)

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 인증 성공 여부 |
| status | string | 사업자 상태 (active, suspended, closed) |
| business_name | string | 사업자명 |
| owner_name | string | 대표자명 |
| address | string | 사업장 소재지 |
| business_type | string | 업태 |
| business_item | string | 종목 |

　D. 응답 데이터 (실패)

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | false |
| error_code | string | 에러 코드 |
| error_message | string | 에러 메시지 |


**6.5.2.** 상태 관리

1: 인증 상태 정의

```javascript
const [verificationState, setVerificationState] = useState({
  status: 'idle', // idle, verifying, success, failed, pending_manual
  businessNumber: '',
  verifiedData: null,
  errorCode: null,
  errorMessage: ''
});
```

2: 상태별 UI 렌더링

```javascript
const renderVerificationStatus = () => {
  switch (verificationState.status) {
    case 'idle':
      return <IdleState />;
    case 'verifying':
      return <LoadingState message="사업자 정보를 확인 중입니다..." />;
    case 'success':
      return <SuccessState data={verificationState.verifiedData} />;
    case 'failed':
      return <FailedState error={verificationState.errorMessage} />;
    case 'pending_manual':
      return <PendingManualState />;
  }
};
```


**6.5.3.** 인증 프로세스

1: 자동 인증 처리

```javascript
const handleVerification = async () => {
  setVerificationState(prev => ({ ...prev, status: 'verifying' }));
  
  try {
    const response = await verifyBusiness(verificationState.businessNumber);
    
    if (response.success) {
      setVerificationState({
        status: 'success',
        businessNumber: verificationState.businessNumber,
        verifiedData: response,
        errorCode: null,
        errorMessage: ''
      });
    } else {
      handleVerificationError(response);
    }
  } catch (error) {
    setVerificationState(prev => ({
      ...prev,
      status: 'failed',
      errorCode: 'NETWORK_ERROR',
      errorMessage: '네트워크 오류가 발생했습니다'
    }));
  }
};
```

2: 에러 처리

```javascript
const handleVerificationError = (response) => {
  const errorMessages = {
    'BIZ_001': '사업자등록번호를 확인해주세요',
    'BIZ_002': '휴업 상태의 사업자입니다',
    'BIZ_003': '폐업 상태의 사업자입니다',
    'BIZ_004': '사업자 정보를 조회할 수 없습니다',
    'BIZ_005': '신규 등록 사업자입니다. 1~2일 후 다시 시도해주세요'
  };
  
  setVerificationState(prev => ({
    ...prev,
    status: 'failed',
    errorCode: response.error_code,
    errorMessage: errorMessages[response.error_code] || '인증에 실패했습니다'
  }));
};
```


**6.5.4.** 수동 인증 처리

1: 이미지 업로드

```javascript
import ImagePicker from 'react-native-image-picker';

const handleImageUpload = async (source) => {
  const options = {
    mediaType: 'photo',
    quality: 0.8,
    maxWidth: 1920,
    maxHeight: 1080
  };
  
  const result = source === 'camera'
    ? await ImagePicker.launchCamera(options)
    : await ImagePicker.launchImageLibrary(options);
  
  if (!result.didCancel && result.assets?.[0]) {
    return uploadBusinessLicense(result.assets[0]);
  }
};
```

2: API 호출 - 수동 인증 요청
　A. 엔드포인트: POST /api/v1/business/manual-verify
　B. 요청 (multipart/form-data)

```javascript
const formData = new FormData();
formData.append('business_number', businessNumber);
formData.append('license_image', {
  uri: imageUri,
  type: 'image/jpeg',
  name: 'business_license.jpg'
});
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 요청 접수 여부 |
| request_id | string | 수동 인증 요청 ID |
| estimated_time | string | 예상 처리 시간 |


**6.5.5.** 수동 인증 상태 확인

1: API 호출 - 인증 상태 조회
　A. 엔드포인트: GET /api/v1/business/manual-verify/{requestId}/status
　B. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| status | string | pending, approved, rejected |
| verified_data | object | 인증된 사업자 정보 (approved인 경우) |
| reject_reason | string | 반려 사유 (rejected인 경우) |

2: 폴링 또는 푸시 알림

```javascript
// 앱 포그라운드 시 폴링
useEffect(() => {
  if (verificationState.status === 'pending_manual') {
    const interval = setInterval(async () => {
      const status = await checkManualVerificationStatus(requestId);
      if (status.status !== 'pending') {
        handleManualVerificationResult(status);
        clearInterval(interval);
      }
    }, 30000); // 30초마다 확인
    
    return () => clearInterval(interval);
  }
}, [verificationState.status]);
```


**6.5.6.** 화면 전환 처리

1: 다음 단계로 이동

```javascript
const handleNext = async () => {
  if (verificationState.status !== 'success') {
    return;
  }
  
  try {
    await saveVerificationResult(verificationState.verifiedData);
    
    navigation.navigate('StoreDetailInfo', {
      businessName: verificationState.verifiedData.business_name,
      ownerName: verificationState.verifiedData.owner_name,
      address: verificationState.verifiedData.address
    });
  } catch (error) {
    handleError(error);
  }
};
```


**6.5.7.** 에러 코드 정의

| 에러 코드 | 설명 | 사용자 메시지 |
|---|---|---|
| BIZ_001 | 사업자등록번호 형식 오류 | 올바른 사업자등록번호를 입력해주세요 |
| BIZ_002 | 휴업 상태 | 휴업 상태의 사업자입니다. 고객센터로 문의해주세요 |
| BIZ_003 | 폐업 상태 | 폐업 상태의 사업자입니다 |
| BIZ_004 | 조회 불가 | 사업자 정보를 조회할 수 없습니다 |
| BIZ_005 | 신규 사업자 | 신규 등록 사업자입니다. 1~2일 후 다시 시도해주세요 |
| BIZ_006 | 이미지 업로드 실패 | 이미지 업로드에 실패했습니다 |
| BIZ_007 | 수동 인증 반려 | 사업자등록증을 다시 확인해주세요 |


**6.5.8.** 접근성 요구사항

1: 인증 상태 알림

```javascript
<View
  accessibilityRole="alert"
  accessibilityLiveRegion="polite"
>
  {verificationState.status === 'success' && (
    <Text accessibilityLabel="사업자 인증이 완료되었습니다">
      ✓ 인증 완료
    </Text>
  )}
</View>
```

2: 버튼 접근성

```javascript
<TouchableOpacity
  accessibilityLabel="사업자 인증하기"
  accessibilityHint="국세청 API를 통해 사업자 정보를 확인합니다"
  accessibilityState={{ disabled: verificationState.status === 'verifying' }}
  onPress={handleVerification}
>
  <Text>인증하기</Text>
</TouchableOpacity>
```


• 참조: 7-1-1-7. 매장 상세 정보 설정
