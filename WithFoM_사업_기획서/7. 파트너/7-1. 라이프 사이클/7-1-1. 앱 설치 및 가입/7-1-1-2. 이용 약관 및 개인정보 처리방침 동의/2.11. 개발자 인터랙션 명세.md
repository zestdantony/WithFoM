**2.11.** 개발자 인터랙션 명세


**2.11.1.** 약관 데이터 로딩

1: API 호출 - 약관 목록 조회
　A. 엔드포인트: GET /api/v1/terms/list
　B. 요청 파라미터: 없음
　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| terms | array | 약관 목록 |
| terms[].id | string | 약관 고유 ID |
| terms[].title | string | 약관 제목 |
| terms[].required | boolean | 필수 여부 |
| terms[].version | string | 약관 버전 |
| terms[].content_url | string | 약관 전문 URL |

2: 약관 데이터 구조

```javascript
const termsData = [
  { id: 'service_terms', title: '서비스 이용 약관', required: true },
  { id: 'privacy_policy', title: '개인정보 처리방침', required: true },
  { id: 'location_terms', title: '위치 정보 이용 동의', required: true },
  { id: 'third_party_advertiser', title: '제3자 정보 제공 동의 (광고주)', required: true },
  { id: 'marketing', title: '마케팅 정보 수신 동의', required: false },
  { id: 'third_party_partner', title: '제3자 정보 제공 동의 (제휴사)', required: false },
  { id: 'behavioral_info', title: '행태정보 수집 및 이용 동의', required: false },
  { id: 'cookie', title: '쿠키 사용 동의', required: false },
  { id: 'app_permission', title: '앱 권한 동의', required: false }
];
```


**2.11.2.** 약관 전문 조회

1: API 호출 - 약관 전문 조회
　A. 엔드포인트: GET /api/v1/terms/{termId}/content
　B. 요청 파라미터

| 파라미터 | 타입 | 설명 |
|---|---|---|
| termId | string | 약관 고유 ID |

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| id | string | 약관 고유 ID |
| title | string | 약관 제목 |
| content | string | 약관 전문 (HTML 또는 Markdown) |
| version | string | 약관 버전 |
| effective_date | string | 시행일 |


**2.11.3.** 동의 상태 관리

1: 상태 변수 정의

```javascript
const [agreements, setAgreements] = useState({
  all: false,
  service_terms: false,
  privacy_policy: false,
  location_terms: false,
  third_party_advertiser: false,
  marketing: false,
  third_party_partner: false,
  behavioral_info: false,
  cookie: false,
  app_permission: false
});
```

2: 전체 동의 처리

```javascript
const handleAllAgree = (checked) => {
  const newAgreements = {};
  Object.keys(agreements).forEach(key => {
    newAgreements[key] = checked;
  });
  setAgreements(newAgreements);
};
```

3: 개별 동의 처리

```javascript
const handleIndividualAgree = (termId, checked) => {
  const newAgreements = { ...agreements, [termId]: checked };
  
  // 전체 동의 상태 자동 업데이트
  const requiredTerms = termsData.filter(t => t.required).map(t => t.id);
  const optionalTerms = termsData.filter(t => !t.required).map(t => t.id);
  const allTerms = [...requiredTerms, ...optionalTerms];
  
  newAgreements.all = allTerms.every(id => newAgreements[id]);
  setAgreements(newAgreements);
};
```

4: 필수 약관 동의 확인

```javascript
const isRequiredAgreed = () => {
  const requiredTerms = termsData.filter(t => t.required);
  return requiredTerms.every(term => agreements[term.id]);
};
```


**2.11.4.** 동의 정보 제출

1: API 호출 - 약관 동의 제출
　A. 엔드포인트: POST /api/v1/terms/agree
　B. 요청 바디

```json
{
  "agreements": [
    { "term_id": "service_terms", "agreed": true, "version": "1.0.0" },
    { "term_id": "privacy_policy", "agreed": true, "version": "1.0.0" },
    { "term_id": "location_terms", "agreed": true, "version": "1.0.0" },
    { "term_id": "third_party_advertiser", "agreed": true, "version": "1.0.0" },
    { "term_id": "marketing", "agreed": false, "version": "1.0.0" }
  ],
  "agreed_at": "2024-01-15T10:30:00Z",
  "device_info": {
    "os": "iOS",
    "os_version": "17.0",
    "app_version": "1.0.0"
  }
}
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 처리 성공 여부 |
| session_token | string | 가입 세션 토큰 (이후 단계에서 사용) |


**2.11.5.** 화면 전환 처리

1: 다음 단계로 이동

```javascript
const handleNext = async () => {
  if (!isRequiredAgreed()) {
    showToast('필수 약관에 모두 동의해주세요');
    return;
  }
  
  try {
    const response = await submitAgreements(agreements);
    if (response.success) {
      navigation.navigate('IdentityVerification', {
        sessionToken: response.session_token
      });
    }
  } catch (error) {
    showToast('오류가 발생했습니다. 다시 시도해주세요.');
    logError(error, 'terms_agreement_submit');
  }
};
```

2: 화면 전환 애니메이션

```javascript
const screenOptions = {
  cardStyleInterpolator: CardStyleInterpolators.forHorizontalIOS,
  transitionSpec: {
    open: { animation: 'timing', config: { duration: 300 } },
    close: { animation: 'timing', config: { duration: 300 } }
  }
};
```


**2.11.6.** 모달 처리

1: 약관 전문 모달 상태 관리

```javascript
const [modalState, setModalState] = useState({
  visible: false,
  termId: null,
  content: null,
  loading: false
});

const openTermModal = async (termId) => {
  setModalState({ visible: true, termId, content: null, loading: true });
  
  try {
    const content = await fetchTermContent(termId);
    setModalState({ visible: true, termId, content, loading: false });
  } catch (error) {
    setModalState({ visible: false, termId: null, content: null, loading: false });
    showToast('약관을 불러오지 못했습니다.');
  }
};

const closeTermModal = () => {
  setModalState({ visible: false, termId: null, content: null, loading: false });
};
```

2: 모달 닫기 처리
　A. [닫기] 버튼 클릭: closeTermModal()
　B. 배경 클릭: closeTermModal()
　C. 스와이프 다운 (바텀 시트): closeTermModal()
　D. 하드웨어 뒤로가기: closeTermModal()


**2.11.7.** 에러 처리

1: 약관 목록 로딩 실패
　A. 에러 메시지: "약관 정보를 불러오지 못했습니다"
　B. [다시 시도] 버튼 제공
　C. 최대 재시도 횟수: 3회

2: 동의 정보 제출 실패
　A. 에러 메시지: "오류가 발생했습니다. 다시 시도해주세요."
　B. [다시 시도] 버튼 제공
　C. 네트워크 오류 시: 오프라인 안내 메시지

3: 에러 로깅

```javascript
const logError = async (error, context) => {
  await analytics.logEvent('terms_error', {
    error_message: error.message,
    error_code: error.code,
    context: context,
    timestamp: new Date().toISOString()
  });
};
```


**2.11.8.** 접근성 요구사항

1: 스크린 리더 지원
　A. 체크박스에 적절한 접근성 라벨 적용
　B. 필수 약관 표시: "(필수)" 텍스트 포함
　C. 동의 상태 알림: "동의함" / "동의하지 않음"

2: 접근성 라벨 예시

```javascript
<Checkbox
  accessibilityLabel={`${term.title} ${term.required ? '필수' : '선택'}`}
  accessibilityState={{ checked: agreements[term.id] }}
  accessibilityHint="탭하여 동의 상태를 변경합니다"
/>
```

3: 키보드 네비게이션
　A. Tab 키로 체크박스 간 이동
　B. Space 키로 체크박스 토글
　C. Enter 키로 [다음] 버튼 활성화


• 참조: 7-1-1-3. 본인 인증
