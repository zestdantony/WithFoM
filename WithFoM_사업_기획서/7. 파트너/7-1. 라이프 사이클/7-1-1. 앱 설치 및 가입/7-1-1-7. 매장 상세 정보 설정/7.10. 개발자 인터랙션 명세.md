**7.10.** 개발자 인터랙션 명세


**7.10.1.** 상태 관리

1: 전체 폼 상태

```javascript
const [detailInfo, setDetailInfo] = useState({
  // 1단계: 컵홀더 유형
  cupholderType: {
    types: [], // ['solo', 'collab']
    holderKinds: [], // ['cupholder', 'airholder']
    excludedAdCategories: [] // 최대 3개
  },
  // 2단계: 서비스 타입
  serviceType: '', // 'reward', 'order', 'hybrid'
  // 3단계: 상권
  commercialArea: '', // 'office', 'residential', 'university', etc.
  // 4단계: 고객층
  customerSegments: [], // ['worker', 'student', 'housewife', 'family']
  // 5단계: 고객 구성
  customerComposition: {
    genderRatio: { male: 50, female: 50 },
    ageGroups: {} // { '20s': 30, '30s': 40, '40s': 30 }
  },
  // 6단계: 음료 가격
  beverages: [
    { name: '', price: 0 },
    { name: '', price: 0 },
    { name: '', price: 0 }
  ],
  // 7단계: 일일 소진량
  dailyConsumption: 0,
  // 8단계: 수용량
  storageCapacity: 0
});

const [currentStep, setCurrentStep] = useState(1);
const [stepCompleted, setStepCompleted] = useState([false, false, false, false, false, false, false, false]);
```


**7.10.2.** 단계별 유효성 검사

1: 단계별 완료 조건

```javascript
const validateStep = (step) => {
  switch (step) {
    case 1:
      return detailInfo.cupholderType.types.length > 0 &&
             detailInfo.cupholderType.holderKinds.length > 0;
    case 2:
      return detailInfo.serviceType !== '';
    case 3:
      return detailInfo.commercialArea !== '';
    case 4:
      return detailInfo.customerSegments.length > 0;
    case 5:
      return detailInfo.customerComposition.genderRatio.male +
             detailInfo.customerComposition.genderRatio.female === 100;
    case 6:
      return detailInfo.beverages.every(b => b.name && b.price > 0);
    case 7:
      return detailInfo.dailyConsumption > 0;
    case 8:
      return detailInfo.storageCapacity > 0;
    default:
      return false;
  }
};
```


**7.10.3.** 컵홀더 유형 선택 컴포넌트

1: 유형 선택 UI

```javascript
const CupholderTypeSelector = ({ selected, onChange }) => {
  const types = [
    { id: 'solo', label: '단독', description: '광고주 비주얼 100% + 무료 제공' },
    { id: 'collab', label: '콜라보', description: '파트너 로고 노출 + 반값 지원' }
  ];
  
  const toggleType = (typeId) => {
    const newSelected = selected.includes(typeId)
      ? selected.filter(t => t !== typeId)
      : [...selected, typeId];
    onChange(newSelected);
  };
  
  return (
    <View>
      {types.map(type => (
        <SelectableButton
          key={type.id}
          selected={selected.includes(type.id)}
          onPress={() => toggleType(type.id)}
          label={type.label}
          description={type.description}
        />
      ))}
    </View>
  );
};
```

2: 광고군 제외 선택

```javascript
const AD_CATEGORIES = [
  { id: 'alcohol', label: '주류' },
  { id: 'tobacco', label: '담배' },
  { id: 'gambling', label: '도박/카지노' },
  { id: 'adult', label: '성인' },
  { id: 'politics', label: '정치' },
  { id: 'religion', label: '종교' },
  { id: 'competitor', label: '경쟁사' }
];

const AdCategoryExcluder = ({ selected, onChange, maxCount = 3 }) => {
  const toggleCategory = (categoryId) => {
    if (selected.includes(categoryId)) {
      onChange(selected.filter(c => c !== categoryId));
    } else if (selected.length < maxCount) {
      onChange([...selected, categoryId]);
    } else {
      showToast(`최대 ${maxCount}개까지 선택 가능합니다`);
    }
  };
  
  return (/* 컴포넌트 렌더링 */);
};
```


**7.10.4.** 서비스 타입 선택

1: 서비스 타입 옵션

```javascript
const SERVICE_TYPES = [
  {
    id: 'reward',
    label: '리워드형',
    icon: 'gift',
    description: 'QR 스캔 후 게임/리워드 제공'
  },
  {
    id: 'order',
    label: '오더형',
    icon: 'cart',
    description: '앱 주문·결제 제공'
  },
  {
    id: 'hybrid',
    label: '복합형',
    icon: 'star',
    description: '리워드 + 오더 모두 사용'
  }
];
```


**7.10.5.** 고객 구성 슬라이더

1: 성별 비율 슬라이더

```javascript
import Slider from '@react-native-community/slider';

const GenderRatioSlider = ({ value, onChange }) => {
  return (
    <View>
      <View style={styles.labelRow}>
        <Text>남성 {value}%</Text>
        <Text>여성 {100 - value}%</Text>
      </View>
      <Slider
        minimumValue={0}
        maximumValue={100}
        step={5}
        value={value}
        onValueChange={(val) => onChange({ male: val, female: 100 - val })}
      />
    </View>
  );
};
```


**7.10.6.** 폼 제출 처리

1: API 호출 - 상세 정보 저장
　A. 엔드포인트: POST /api/v1/partner/store/detail-info
　B. 요청 바디

```json
{
  "store_id": "store_123",
  "cupholder_type": {
    "types": ["solo", "collab"],
    "holder_kinds": ["cupholder", "airholder"],
    "excluded_ad_categories": ["alcohol", "tobacco"]
  },
  "service_type": "hybrid",
  "commercial_area": "office",
  "customer_segments": ["worker", "student"],
  "customer_composition": {
    "gender_ratio": { "male": 60, "female": 40 },
    "age_groups": { "20s": 30, "30s": 50, "40s": 20 }
  },
  "beverages": [
    { "name": "아메리카노", "price": 4500 },
    { "name": "카페라떼", "price": 5000 },
    { "name": "바닐라라떼", "price": 5500 }
  ],
  "daily_consumption": 100,
  "storage_capacity": 500
}
```

　C. 응답 데이터

| 필드 | 타입 | 설명 |
|---|---|---|
| success | boolean | 저장 성공 여부 |
| next_step | string | 다음 단계 정보 |


**7.10.7.** 화면 전환 처리

1: 단계 이동

```javascript
const handleNext = async () => {
  if (!validateStep(currentStep)) {
    showValidationError();
    return;
  }
  
  // 중간 저장 (선택적)
  await saveProgress(currentStep, detailInfo);
  
  if (currentStep < 8) {
    setCurrentStep(currentStep + 1);
    setStepCompleted(prev => {
      const newCompleted = [...prev];
      newCompleted[currentStep - 1] = true;
      return newCompleted;
    });
  } else {
    // 마지막 단계 완료
    handleComplete();
  }
};

const handlePrevious = () => {
  if (currentStep > 1) {
    setCurrentStep(currentStep - 1);
  }
};
```

2: 전체 완료 처리

```javascript
const handleComplete = async () => {
  try {
    const response = await saveDetailInfo(detailInfo);
    
    if (response.success) {
      navigation.navigate('PartnerContract', {
        storeId: route.params.storeId,
        detailInfo: detailInfo
      });
    }
  } catch (error) {
    handleError(error);
  }
};
```


**7.10.8.** 에러 처리

1: 에러 코드 매핑

| 에러 코드 | 설명 | 사용자 메시지 |
|---|---|---|
| DETAIL_001 | 필수 항목 누락 | 모든 필수 항목을 입력해주세요 |
| DETAIL_002 | 유효하지 않은 값 | 입력 값을 확인해주세요 |
| DETAIL_003 | 저장 실패 | 저장에 실패했습니다. 다시 시도해주세요 |


**7.10.9.** 접근성 요구사항

1: 스텝 인디케이터 접근성

```javascript
<View
  accessibilityRole="progressbar"
  accessibilityLabel={`매장 상세 정보 설정 ${currentStep}단계 중 ${currentStep}단계`}
  accessibilityValue={{ min: 1, max: 8, now: currentStep }}
>
  {/* 스텝 인디케이터 UI */}
</View>
```

2: 선택 버튼 접근성

```javascript
<TouchableOpacity
  accessibilityRole="checkbox"
  accessibilityState={{ checked: selected }}
  accessibilityLabel={`${label} ${selected ? '선택됨' : '선택 안됨'}`}
  onPress={onToggle}
>
  {/* 버튼 UI */}
</TouchableOpacity>
```


• 참조: 7-1-1-8. 파트너 계약서 작성
