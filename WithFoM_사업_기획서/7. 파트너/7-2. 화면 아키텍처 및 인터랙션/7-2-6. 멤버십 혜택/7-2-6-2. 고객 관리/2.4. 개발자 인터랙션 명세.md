<!-- WF:DOC=DEV -->
**2.4.** 개발자 인터랙션 명세  


**2.4.1.** API 명세  


**2.4.1.1.** 고객(방문객) 리스트 조회  

1: 엔드포인트  
　A. `GET /api/v1/partner/customers`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 쿼리 파라미터  

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| searchType | string | N | nickname \| memberId |
| searchKeyword | string | N | 검색어 (searchType과 쌍으로 사용) |
| sortBy | string | N | joinDate(가입순) \| paymentAmount(결제순) \| visitCount(방문순) \| stampUsage(스탬프 사용순) \| couponUsage(쿠폰 사용순) \| pointUsage(포인트 사용순). 기본값: joinDate |
| datePreset | string | N | day \| week \| month \| year \| custom |
| startDate | string | N | YYYY-MM-DD (datePreset=custom 시 필수) |
| endDate | string | N | YYYY-MM-DD (datePreset=custom 시 필수) |
| status | string | N | all(전체) \| active(일반) \| dormant(휴면). 기본값: all. 전체 선택 시 일반+휴면 함께 표시, 휴면 선택 시 휴면만 필터링 |
| dormantDays | number | N | 30 \| 60 \| 90. status=dormant 시에만 유효. 미방문 기간별 세분화(프리미엄만, 플러스는 30일 고정) |
| page | number | N | 1 이상, 기본값 1 |
| size | number | N | 페이지당 건수, 기본값 50 (최대 50) |

3: 응답 JSON  

```json
{
  "items": [
    {
      "customerId": "string",
      "nickname": "string",
      "memberId": "string",
      "joinedAt": "YYYY-MM-DD",
      "visitCount": 0,
      "totalPaymentAmount": 0,
      "stampIssued": 0,
      "stampUsed": 0,
      "couponIssued": 0,
      "couponUsed": 0,
      "pointIssued": 0,
      "pointUsed": 0,
      "lastVisitedAt": "YYYY-MM-DD",
      "status": "active | dormant"
    }
  ],
  "totalCount": 0,
  "page": 1,
  "size": 50,
  "totalPages": 0
}
```

4: 응답 필드 (items 요소)  
　A. status: active(일반), dormant(휴면 — 30일 이상 재방문 없음)  
　B. 스탬프/쿠폰/포인트는 발행·사용 각각 표시 (2.1. 검색 섹션, 2.2. 오늘 방문객 리스트·검색 결과 섹션과 동일)  

5: 에러  
　A. 401: 미인증  
　B. 403: 멤버십 미해당(고객 관리 권한 없음)  
　C. CUS_001: 조회 실패  


**2.4.1.2.** 휴면 고객 알림톡 발송(플러스 이상)  

1: 엔드포인트  
　A. `POST /api/v1/partner/customers/dormant/notify`  
　B. 인증: Bearer Token (파트너 세션, 플러스 이상 멤버십)  

2: 요청 바디  

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| customerIds | string[] | Y | 발송 대상 고객 ID 배열 |
| templateId | string | N | 메시지 템플릿 ID (미지정 시 기본 템플릿) |
| customMessage | string | N | 직접 입력 메시지 (templateId와 배타적) |
| dormantDays | number | N | 휴면 기간 필터(30/60/90, 프리미엄만) |

3: 응답  
　A. 성공: `{ "sentCount": 5, "remainingQuota": 25, "month": "2026-02" }`  
　B. 403: 플러스 미만 멤버십 또는 월 발송 한도 초과  
　C. 404: 대상 고객 없음  
　D. 에러 코드: DRM_001(발송 실패), DRM_002(한도 초과)  

4: 접근성  
　A. 발송 버튼: aria-label="휴면 고객 알림톡 발송"  


**2.4.1.3.** 알림톡 발송 이력 조회(플러스 이상)  

1: 엔드포인트  
　A. `GET /api/v1/partner/customers/dormant/notify/history`  
　B. 인증: Bearer Token (파트너 세션, 플러스 이상 멤버십)  

2: 요청 쿼리 파라미터  

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| page | number | N | 1 이상, 기본값 1 |
| size | number | N | 페이지당 건수, 기본값 20 |
| startDate | string | N | YYYY-MM-DD (조회 시작일) |
| endDate | string | N | YYYY-MM-DD (조회 종료일) |

3: 응답 JSON  

```json
{
  "items": [
    {
      "notifyId": "string",
      "sentAt": "YYYY-MM-DDTHH:mm:ss",
      "targetCount": 10,
      "sentCount": 8,
      "failedCount": 2,
      "templateTitle": "string | null",
      "messagePreview": "string",
      "dormantDays": 30,
      "conversionRate": 0.25,
      "revisitedCount": 2
    }
  ],
  "totalCount": 0,
  "page": 1,
  "size": 20,
  "totalPages": 0
}
```

4: 응답 필드  
　A. targetCount: 발송 대상 고객 수  
　B. sentCount/failedCount: 발송 성공·실패 건수  
　C. conversionRate: 재방문 전환율(발송 후 30일 내 재방문한 고객 비율)  
　D. revisitedCount: 재방문 전환 고객 수  

5: 에러  
　A. 401: 미인증  
　B. 403: 플러스 미만 멤버십  
　C. DRM_003: 이력 조회 실패  


**2.4.1.4.** 알림톡 메시지 템플릿 목록 조회(플러스 이상)  

1: 엔드포인트  
　A. `GET /api/v1/partner/customers/dormant/notify/templates`  
　B. 인증: Bearer Token (파트너 세션, 플러스 이상 멤버십)  

2: 응답 JSON  

```json
{
  "templates": [
    {
      "templateId": "string",
      "title": "string",
      "content": "string",
      "isDefault": true,
      "category": "return_coupon | greeting | event"
    }
  ]
}
```

3: 응답 필드  
　A. templateId: 템플릿 고유 ID (2.4.1.2. 발송 시 templateId로 사용)  
　B. title: 템플릿 제목(선택 리스트 표시용)  
　C. content: 메시지 본문(미리보기용)  
　D. isDefault: 기본 템플릿 여부(하나만 true)  
　E. category: 템플릿 유형(재방문 쿠폰/인사/이벤트 등)  

4: 에러  
　A. 401: 미인증  
　B. 403: 플러스 미만 멤버십  


**2.4.2.** 컴포넌트 구현 참고  


**2.4.2.1.** 검색·필터 상태  

1: searchType, searchKeyword, sortBy, datePreset, startDate, endDate, status, dormantDays를 클라이언트 상태로 보관  
2: 검색 실행·정렬 변경·기간 변경·상태 필터 전환 시 위 파라미터로 GET /api/v1/partner/customers 호출 후 items로 리스트 갱신  

**2.4.2.2.** 페이지네이션  

1: totalPages, page, size로 이전/다음/페이지 번호 버튼 활성화 제어  
2: 페이지 변경 시 page 파라미터만 변경하여 동일 엔드포인트 재호출  

**2.4.2.3.** 빈 상태  

1: totalCount === 0 시 "검색 결과가 없습니다" 또는 기간·검색 조건에 따른 안내 문구 표시  
2: status=dormant 필터 적용 상태에서 totalCount === 0 시 "휴면 고객이 없습니다" 안내 표시  

**2.4.2.4.** 휴면 고객 필터  

1: 기본 동작  
　A. 화면 초기 진입 시 status=all(기본값)로 일반·휴면 고객 전체 표시  
　B. 리스트의 각 고객 행에 status 뱃지 표시(일반: 회색, 휴면: 주황)  
　C. status 필터 탭 또는 드롭다운으로 all/active/dormant 전환 가능  
2: 필터 전환 시 처리  
　A. status 변경 시 page=1로 초기화 후 GET /api/v1/partner/customers 재호출  
　B. 기존 검색·정렬·기간 조건은 유지하며 status 파라미터만 추가/변경  
3: dormantDays 세분화(프리미엄)  
　A. status=dormant 선택 시 dormantDays 서브 필터 노출(30일/60일/90일)  
　B. 플러스 플랜: dormantDays 서브 필터 미노출(30일 고정)  
　C. 프리미엄 플랜: dormantDays 선택 가능, 변경 시 page=1 초기화 후 재호출  
4: 알림톡 발송 연동  
　A. status=dormant 상태에서 고객 선택 체크박스 활성화  
　B. 선택된 고객 ID 배열로 POST /api/v1/partner/customers/dormant/notify 호출 (2.4.1.2. 참조)  
　C. 발송 완료 후 리스트 자동 갱신  

**2.4.2.5.** 발송 이력·템플릿 연동  

1: 발송 이력 표시  
　A. 휴면 케어 섹션 하단에 최근 발송 이력 요약 표시(최근 3건)  
　B. "전체 보기" 클릭 시 GET /api/v1/partner/customers/dormant/notify/history 호출 (2.4.1.3. 참조)  
2: 템플릿 선택  
　A. 알림톡 발송 시 템플릿 선택 드롭다운 노출  
　B. GET /api/v1/partner/customers/dormant/notify/templates 호출 후 목록 바인딩 (2.4.1.4. 참조)  
　C. isDefault=true 템플릿을 기본 선택 상태로 설정  
　D. "직접 입력" 옵션 선택 시 customMessage 텍스트 영역 전환  


• 참조: 7-2-6-2. 고객 관리 > 2.0. 페이지 개요, 2.1. 검색 섹션, 2.2. 오늘 방문객 리스트·검색 결과 섹션, 2.3. 액션 버튼 및 화면 전환  
