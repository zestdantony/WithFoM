<!-- WF:DOC=DEV -->
**1.4.** 개발자 인터랙션 명세  


**1.4.1.** API 명세  


**1.4.1.1.** 현재 멤버십 플랜 조회 API  

1: 엔드포인트  
　A. `GET /api/v1/partner/membership/current`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답 JSON  

```json
{
  "plan": "PLUS",
  "planLabel": "플러스",
  "startedAt": "2026-01-01",
  "renewAt": "2026-02-01",
  "promotion": {
    "type": "FREE_MONTHS",
    "description": "3달 무료"
  },
  "features": {
    "stamp": "EXTENDED",
    "stampTemplateCount": 3,
    "stampAiCustom": false,
    "stampAiRegenLimitPerMonth": 0,
    "alarmLimit": 30
  }
}
```  

3: 응답 필드  
　A. `plan`: BASIC | PLUS | PREMIUM  
　B. `planLabel`: 화면 표시용 플랜명  
　C. `startedAt`, `renewAt`: 구독 시작일·갱신일 (플러스/프리미엄만 유의미, 베이직은 null 가능)  
　D. `promotion`: 프로모션 정보 (3달 무료, 6개월 할인 등)  
　E. `features.stamp`: BASIC(기본 1종) | EXTENDED(3종 로고 믹스) | PREMIUM(5종+AI 커스텀). 스탬프 기능은 베이직부터 제공, 플러스에서 3종 확장, 프리미엄에서 5종+AI 디자인 커스텀  
　F. `features.stampTemplateCount`: 사용 가능 스탬프 템플릿 수 (베이직: 1, 플러스: 3, 프리미엄: 5)  
　G. `features.stampAiCustom`: AI 디자인 커스텀 사용 가능 여부 (프리미엄만 true)  
　H. `features.stampAiRegenLimitPerMonth`: 스탬프 AI 디자인 재생성 월 한도. PREMIUM일 때 2, BASIC/PLUS일 때 0. 클라이언트는 `stampAiCustom === true`일 때만 "이번 달 남은 재생성: N/2회" 표시  
　I. `features.alarmLimit`: 알림톡 월 한도 (플러스 30, 프리미엄 300 등)  


**1.4.1.2.** 플랜별 혜택 상세 조회 API (상세페이지/모달용)  

1: 엔드포인트  
　A. `GET /api/v1/partner/membership/plans`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답 JSON  

```json
{
  "plans": [
    {
      "id": "BASIC",
      "name": "베이직",
      "shortDescription": "기본 운영 기능 무료 제공",
      "price": 0,
      "priceLabel": "무료",
      "benefits": [
        "등급별 컵홀더 발주 혜택",
        "운영 현황 요약",
        "스탬프 기능 (기본 제공)",
        "위드폼 오더·리워드 기능",
        "기본 리포트",
        "고객 리스트 관리",
        "빠른 발주·재고 관리"
      ],
      "stampLevel": "BASIC"
    },
    {
      "id": "PLUS",
      "name": "플러스",
      "shortDescription": "단골·재방문 관리 중심",
      "price": 29000,
      "priceLabel": "₩29,000",
      "promotion": "3달 무료",
      "benefits": [
        "베이직 전체 포함",
        "스탬프 카드 템플릿 3종 (위드폼·파트너 로고 믹스)",
        "지도 핀 커스터마이징",
        "AI 리뷰 답글 생성",
        "휴면 고객 케어 (알림톡 월 30회)",
        "고객 관리 랭킹·벤치마크"
      ],
      "stampLevel": "EXTENDED"
    },
    {
      "id": "PREMIUM",
      "name": "프리미엄",
      "shortDescription": "정밀 분석 + 고급 기능",
      "price": 49000,
      "priceLabel": "₩49,000→34,000",
      "promotion": "6개월 할인",
      "benefits": [
        "플러스 전체 포함",
        "스탬프 카드 템플릿 5종 + AI 디자인 커스텀",
        "지도 핀 AI 아이콘 생성",
        "휴면·우수 고객 관리 (알림톡 월 300회)",
        "포스터 제작 AI 툴",
        "세분화 벤치마크·인사이트",
        "랭킹·퍼센타일·우선 지원"
      ],
      "stampLevel": "PREMIUM"
    }
  ]
}
```  

3: 응답 필드 (플랜 객체)  
　A. `shortDescription`: 카드 내 한 줄 설명(태그라인). 베이직 "기본 운영 기능 무료 제공", 플러스 "단골·재방문 관리 중심", 프리미엄 "정밀 분석 + 고급 기능" (1.1. 위드폼 멤버십 섹션과 동일)  
　B. `benefits`: 혜택 리스트(카드 내 불릿 표시용)  
　C. `stampLevel`: 스탬프 기능 제공 수준 (BASIC/EXTENDED/PREMIUM)  

4: 용도  
　A. 멤버십 구독 페이지 로드 시 플랜 카드 구성 데이터 (플랜명·요금·shortDescription·benefits 표시)  
　B. 상세페이지/모달에서 플랜별 혜택 리스트 표시  
　C. `stampLevel`으로 스탬프 기능 제공 수준 표시 (베이직: 기본, 플러스: 확장, 프리미엄: 고급)  


**1.4.1.3.** 구독 신청(결제 페이지 연결) API  

1: 엔드포인트  
　A. `POST /api/v1/partner/membership/subscribe`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "plan": "PLUS",
  "source": "membership_page"
}
```  

3: 요청 필드  
　A. `plan`: PLUS | PREMIUM  
　B. `source`: membership_page | header_badge (진입 경로)  

4: 응답  
　A. 성공: `{ "paymentUrl": "https://...", "orderId": "..." }` → 결제 페이지로 리다이렉트  
　B. 이미 해당 플랜: `{ "error": "ALREADY_SUBSCRIBED", "currentPlan": "PLUS" }`  
　C. 다운그레이드 불가: 상위 플랜 구독 중 하위 플랜 요청 시 에러  


**1.4.1.4.** 구독 취소 API  

1: 엔드포인트  
　A. `POST /api/v1/partner/membership/cancel`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "reason": "OPTIONAL",
  "feedback": "직접 입력 사유"
}
```  

3: 응답  
　A. 성공: `{ "status": "CANCELLED", "effectiveAt": "2026-02-28" }` (유예 기간 종료일)  
　B. 취소 완료 후 `GET /api/v1/partner/membership/current` 시 `plan`: BASIC  


**1.4.2.** 컴포넌트 구현 참고  

**1.4.2.1.** 카드 구성 분기  
1: `current.plan === 'BASIC'` → 베이직·플러스·프리미엄 3카드, 플러스/프리미엄에 가입 버튼  
2: `current.plan === 'PLUS'` → 플러스·프리미엄 2카드, 플러스 카드에 구독 취소 버튼, 프리미엄 카드에 가입 버튼  
3: `current.plan === 'PREMIUM'` → 프리미엄 1카드, 구독 취소 버튼만 표시  


**1.4.2.2.** 카드 표시 순서 (1.1. 위드폼 멤버십 섹션과 동일)  
1: 플랜명 → 요금(·프로모션) → 한 줄 설명(`shortDescription`) → 혜택 리스트(`benefits`) → 버튼(상세/가입/취소)  
2: 한 줄 설명: 베이직 "기본 운영 기능 무료 제공", 플러스 "단골·재방문 관리 중심", 프리미엄 "정밀 분석 + 고급 기능"  


**1.4.2.3.** 스탬프 기능 표시  
1: 모든 플랜에서 스탬프 기능 사용 가능 (베이직: 기본 1종, 플러스: 3종 로고 믹스, 프리미엄: 5종+AI 커스텀)  
2: 리워드 현황·스탬프 설정 등에서 플랜별로 `stampTemplateCount`·`stampAiCustom` 기반 제한 적용  
3: 프리미엄만 AI 디자인 커스텀 버튼 활성 (플러스 이하: 잠금 + "프리미엄 전용" 안내)  
4: 스탬프 AI 재생성 횟수: `stampAiRegenLimitPerMonth` (프리미엄 2회). UI 표시 "이번 달 남은 재생성: N/2회" — 7-2-8-3. 스탬프 3.2.6.5와 동일  


**1.4.2.4.** 결제 완료 후 화면 전환  

1: 구독 신청 API(`POST /membership/subscribe`) 호출 → 응답의 `paymentUrl`로 리다이렉트 → 외부 결제 서비스에서 결제 처리  
2: 결제 성공 시 결제 서비스가 지정된 returnUrl로 리다이렉트하여 멤버십 구독 페이지로 복귀  
3: 복귀 시 URL 쿼리에 `orderId`·`status=SUCCESS` 포함 → 클라이언트가 `GET /api/v1/partner/membership/current` 재호출하여 변경된 플랜 확인  
4: 변경된 `plan` 값에 따라 1.4.2.1. 카드 구성 분기 로직 재적용 → UI 갱신(카드 수·버튼 구성 전환)  
5: 플랜 변경 완료 토스트 또는 배너 노출(예: "플러스 플랜으로 업그레이드되었습니다")  
6: 결제 실패·취소 시 returnUrl에 `status=FAIL|CANCEL` → 에러 안내 후 현재 화면 유지  


**1.4.3.** 에러 처리  

**1.4.3.1.** 에러 코드  
1: MBR_001: 멤버십 정보 조회 실패  
2: MBR_002: 구독 불가 상태 (이미 해당 플랜 등)  
3: MBR_003: 결제 연동 실패  
4: MBR_004: 취소 정책 위반 (유예 기간 등)  

**1.4.3.2.** 공통  
1: 인증 실패: 401, 로그인 페이지로 유도  
2: 5xx: "일시적인 오류가 발생했습니다" + 재시도 안내  


• 참조: 7-2-6-1. 멤버십 구독 > 1.1. 위드폼 멤버십 섹션, 1.2. 멤버십 상세 설명 섹션, 1.3. 액션 버튼 및 화면 전환, 3-7-4. 파트너 멤버십 등급 및 요금  
