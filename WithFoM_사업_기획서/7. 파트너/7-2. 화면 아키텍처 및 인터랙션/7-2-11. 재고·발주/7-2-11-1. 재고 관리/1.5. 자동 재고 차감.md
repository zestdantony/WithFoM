**1.5.** 자동 재고 차감  


**1.5.1.** 차감 개요  

**1.5.1.1.** 차감 목적  
1: 메뉴 판매 시 레시피에 등록된 재료/구성품 자동 차감  
2: 실시간 재고 현황 파악  
3: 재고 부족 예측 및 자동 발주 트리거  


**1.5.2.** 차감 트리거  

**1.5.2.1.** 위드폼 오더 연동 시  
1: 차감 시점  
　A. 주문 완료(결제 완료) 시점에 재고 차감  
　B. 주문 취소 시 재고 자동 복구  
2: 차감 계산  
　A. 레시피 기본 사용량 × 주문 수량  
　B. 옵션별 재료 변동량 합산  
　C. 주문 유형(매장/테이크아웃)에 따른 구성품 차감  

**1.5.2.2.** 위드폼 오더 미사용 시  
1: 차감 방식  
　A. 일일 판매 수량 수동 입력 시 재고 차감  
　B. 메뉴별 판매 수량 입력 → 레시피 기반 재고 계산  
2: 입력 시점  
　A. 영업 종료 후 일괄 입력  
　B. 수시 입력 (원하는 시점에)  
3: 입력 화면  
　A. 메뉴 리스트에서 판매 수량 입력  
　B. 또는 간편 입력 모달 제공  


**1.5.3.** 차감 상세 로직  

**1.5.3.1.** 재료 차감  
1: 레시피 연동 재료  
　A. 레시피에 등록된 재료별 사용량 차감  
　B. 단위 변환 자동 적용  
　C. 예: 아메리카노 1잔 → 에스프레소 36ml 차감  
2: 옵션 적용  
　A. 옵션별 재료 변동량 추가 차감  
　B. 예: 샷 추가 → 에스프레소 +18ml 추가 차감  

**1.5.3.2.** 구성품 차감  
1: 조건부 차감  
　A. 매장 이용: 구성품 차감 안 함 (머그컵 사용)  
　B. 테이크 아웃: 컵, 뚜껑, 스트로우 등 차감  
2: 사이즈/온도별 구성품  
　A. 스몰 → 12oz 컵 차감  
　B. 아이스 → 플라스틱 컵 차감  
　C. 핫 → 종이 컵 차감  


**1.5.4.** 차감 이력  

**1.5.4.1.** 이력 기록  
1: 기록 항목  
　A. 차감 일시  
　B. 연동 주문번호 (위드폼 오더 시)  
　C. 메뉴명  
　D. 차감량  
　E. 차감 후 재고량  
2: 조회  
　A. 품목 상세 페이지 > 재고 변동 이력에서 조회  
　B. 변동 유형 "출고 (판매연동)"으로 표시  


**1.5.5.** 주문 취소 시 복구  

**1.5.5.1.** 복구 조건  
1: 위드폼 오더 취소 시  
　A. 파트너 거절/취소  
　B. 소비자 취소  
　C. 시스템 자동 취소  
2: 복구 동작  
　A. 차감된 재료/구성품 수량 자동 복구  
　B. 이력에 "입고 (주문취소 복구)"로 기록  


**1.5.6.** 미연동 품목 처리  

**1.5.6.1.** 레시피 미등록 품목  
1: 상황  
　A. 재고 관리에는 등록되어 있으나 레시피에 연동되지 않은 품목  
2: 처리  
　A. 자동 차감 대상 아님  
　B. 수동으로 재고 조정 필요  

**1.5.6.2.** 레시피 연동 알림  
1: 알림 조건  
　A. 레시피에서 사용 중이나 재고 품목과 미매칭인 경우  
2: 알림 내용  
　A. "레시피의 '{재료명}'이 재고 관리와 연동되지 않았습니다"  
　B. [연동 설정] 버튼 제공  


• 참조: 7-2-10-8-3. 재고 연동 설정
