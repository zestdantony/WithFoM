<!-- WF:DOC=DEV -->
**1.2.3.** 개발자 인터랙션 명세  


**1.2.3.1.** 데이터 조회 API  

1: 등급 기준 조회  
　A. 엔드포인트: GET /api/v1/partner/grade/criteria  
　B. 요청 파라미터: partnerId (JWT에서 자동 추출)  

2: 응답 구조 (화면 표시용)  
　A. 화면에 노출되는 기준값만 포함  
　B. 실질 적용 기준은 별도 내부 API로 관리  

```json
{
  "displayCriteria": {
    "reportRate": {
      "bronze": { "displayMin": 0, "displayMax": 84, "label": "85% 미만" },
      "silver": { "displayMin": 85, "displayMax": 99, "label": "85% 이상" },
      "gold": { "displayMin": 100, "displayMax": 100, "label": "100%" },
      "platinum": { "displayMin": 100, "displayMax": 100, "label": "100%" }
    },
    "scanRate": {
      "bronze": { "displayMin": 0, "displayMax": 79, "label": "80% 미만" },
      "silver": { "displayMin": 80, "displayMax": 95, "label": "80~95%" },
      "gold": { "displayMin": 96, "displayMax": 110, "label": "96~110%" },
      "platinum": { "displayMin": 111, "displayMax": null, "label": "110% 초과" }
    },
    "withfomOrder": {
      "label": "위드폼 오더 이용",
      "displayScore": 10
    },
    "weights": {
      "reportRate": 45,
      "scanRate": 45,
      "withfomOrder": 10
    }
  },
  "gradeThresholds": {
    "bronze": { "min": 0, "max": 35 },
    "silver": { "min": 36, "max": 54 },
    "gold": { "min": 55, "max": 72 },
    "platinum": { "min": 73, "max": 100 }
  }
}
```

3: 내부 시스템 적용 기준 (별도 API)  
　A. 엔드포인트: GET /api/v1/internal/grade/actual-criteria  
　B. 접근 권한: 내부 시스템/관리자 전용 (파트너 접근 불가)  
　C. 화면에는 displayCriteria만 표시, 등급 판정은 actualCriteria로 수행  

```json
{
  "actualCriteria": {
    "reportRate": {
      "bronze": { "actualMin": 0, "actualMax": 69 },
      "silver": { "actualMin": 70, "actualMax": 89 },
      "gold": { "actualMin": 90, "actualMax": 100 },
      "platinum": { "actualMin": 90, "actualMax": 100 }
    },
    "scanRate": {
      "bronze": { "actualMin": 0, "actualMax": 79 },
      "silver": { "actualMin": 80, "actualMax": 95 },
      "gold": { "actualMin": 96, "actualMax": 110 },
      "platinum": { "actualMin": 111, "actualMax": null }
    },
    "withfomOrder": {
      "requiredForPlatinum": true,
      "actualScore": 10
    }
  },
  "systemNotes": {
    "platinumRequirement": "위드폼 오더 미이용 시 골드까지만 달성 가능",
    "displayVsActual": "화면 표시 기준과 실질 적용 기준이 상이함에 유의"
  }
}
```


**1.2.3.2.** 컴포넌트 상태 관리  

1: 확장/축소 상태 (expandedSections)  
　A. reportRate: boolean  
　B. scanRate: boolean  
　C. withfomOrder: boolean  

2: 툴팁 상태 (tooltipState)  
　A. visible: boolean  
　B. position: { x, y }  


**1.2.3.3.** 애니메이션 정의  

1: 확장/축소 애니메이션  
　A. duration: 250ms  
　B. easing: ease-in-out  
　C. property: height, opacity  

2: 툴팁 애니메이션  
　A. 등장: fadeIn 200ms  
　B. 사라짐: fadeOut 150ms  


**1.2.3.4.** 접근성 요구사항  

1: ARIA 레이블  
　A. 섹션: role="region", aria-labelledby="grade-criteria-title"  
　B. 확장 영역: aria-expanded="true/false"  
　C. 툴팁: role="tooltip"  

2: 키보드 내비게이션  
　A. Tab: 각 지표 영역 간 이동  
　B. Enter/Space: 확장/축소 토글  
　C. Escape: 툴팁 닫기  


**1.2.3.5.** 에러 처리  

1: 에러 코드  
　A. GRD_001: 등급 기준 조회 실패  

2: 사용자 메시지  
　A. "등급 기준 정보를 불러오지 못했습니다"  
　B. 재시도 버튼 표시  


**1.2.3.6.** 미매칭 알림 시스템  

1: 알림 트리거  
　A. unmatchedMonths === 3: 1차 알림 발송  
　B. unmatchedDays >= 173 (5개월 3주차): 최종 알림 발송  
　C. unmatchedMonths >= 6: 다운그레이드 처리 및 알림  

2: 알림 API  
　A. 엔드포인트: POST /api/v1/partner/grade/unmatched-alert  
　B. 요청 구조:  

```json
{
  "partnerId": "string",
  "alertType": "first_warning" | "final_warning" | "downgrade" | "upgrade",
  "currentGrade": "gold",
  "targetGrade": "silver",
  "channels": {
    "push": true,
    "inApp": true,
    "email": true
  }
}
```

3: 알림 메시지 (1차 알림 - 3개월 경과)  
　A. 제목: "등급 유지 안내"  
　B. 본문: "마지막 캠페인 종료 후 3개월이 지났습니다. {currentGrade} 등급 유지를 위해 새로운 캠페인에 참여가 시급합니다. (미참여 시 {targetGrade}로 조정)"  
　C. CTA: { text: "캠페인 참여하기", action: "navigate", target: "/partner/campaign/order" }  

4: 알림 메시지 (최종 알림 - 5개월 3주차)  
　A. 제목: "[최종 알림] 등급 조정 예정"  
　B. 본문: "등급 조정까지 7일 남았습니다. {currentGrade} 등급과 혜택을 유지하기 위해 새 캠페인 참여가 시급합니다. (미참여 시 {targetGrade}로 조정)"  
　C. CTA: { text: "캠페인 참여하기", action: "navigate", target: "/partner/campaign/order" }  

5: 알림 메시지 (다운그레이드 완료)  
　A. 제목: "등급 변경 안내"  
　B. 본문: "등급이 {previousGrade}에서 {newGrade}으로 변경되었습니다. 새 캠페인에 참여하시면 등급을 다시 높일 수 있습니다."  

6: 알림 메시지 (업그레이드 완료)  
　A. 제목: "등급 상승 축하드립니다"  
　B. 본문: "등급이 {previousGrade}에서 {newGrade}으로 상승했습니다. 새로운 혜택을 확인해 보세요."  
　C. CTA: { text: "혜택 확인하기", action: "navigate", target: "/partner/grade/benefits" }  

7: 알림 채널 처리  

```javascript
const sendGradeAlert = async (alertData) => {
  const { partnerId, alertType, currentGrade, targetGrade, channels } = alertData;
  
  const message = getAlertMessage(alertType, currentGrade, targetGrade);
  
  // 푸시 알림 (필수)
  if (channels.push) {
    await sendPushNotification(partnerId, message);
  }
  
  // 앱 내 알림 (필수 - 알림 센터 저장)
  if (channels.inApp) {
    await saveToNotificationCenter(partnerId, message);
  }
  
  // 이메일 알림 (선택)
  if (channels.email && isEmailAlertEnabled(partnerId)) {
    await sendEmailNotification(partnerId, message);
  }
};
```  


**1.2.3.7.** 다운그레이드 후 재산정 로직  

1: 재산정 트리거  
　A. 다운그레이드 후 새 캠페인 종료 시 자동 재산정  
　B. 해당 캠페인 포함 이전 6개월(플래티넘 1년) 기준  

2: 즉시 업그레이드 조건  
　A. 재산정 점수가 상위 등급 기준 충족  
　B. 캠페인 종료 익월 1일부터 새 등급 적용  

```javascript
const recalculateGrade = (partnerId, campaignEndDate) => {
  // 이전 6개월(플래티넘 1년) 실제 참여 기간 기준 재산정
  const period = currentGrade === 'platinum' ? 365 : 180;
  const participationData = getParticipationData(partnerId, campaignEndDate, period);
  
  const newScore = calculateGradeScore(participationData);
  const newGrade = determineGrade(newScore);
  
  // 조건 충족 시 즉시 업그레이드
  if (newGrade > currentGrade) {
    return { upgrade: true, newGrade };
  }
  return { upgrade: false, currentGrade };
};
```


**1.2.3.8.** 중도 포기 처리  

1: 산정 기간 반영  
　A. 포기 전까지 참여 기간은 등급 산정에 포함  
　B. 포기 시점에 미매칭 카운트 시작  

2: API 처리  
　A. 엔드포인트: POST /api/v1/partner/campaign/withdraw  
　B. 요청: { partnerId, campaignId, withdrawDate }  
　C. 응답: { participationDays, unmatchedStartDate }  


**1.2.3.9.** 성능 최적화  

1: 캐싱  
　A. 세션 스토리지에 24시간 캐싱  
　B. 정책 변경 이벤트 수신 시 캐시 무효화  


• 참조: 7-2-4-1 > 1.3.3. 개발자 인터랙션 명세
