<!-- WF:DOC=DEV -->
**2.3.2.** 개발자 인터랙션 명세  


**2.3.2.1.** QR 스캔율 조회 API  

1: 엔드포인트  
　A. GET /api/v1/partner/grade/scan-rate  

2: 요청 파라미터  
　A. partnerId: 파트너 ID (JWT에서 자동 추출)  

3: 응답 구조  

```json
{
  "hasCampaign": true,
  "weekly": {
    "scanRate": 105.2,
    "todayScan": 45,
    "weekScan": 312,
    "benchmarkAvgWeekScan": 297,
    "trend": {
      "direction": "up",
      "change": 3.5
    }
  },
  "currentCampaign": {
    "campaignId": "CMP-2026-001",
    "round": 3,
    "scanRate": 105.2,
    "myTotalScan": 1250,
    "benchmarkAvgScan": 1188,
    "participatingStores": 245
  },
  "cumulative": {
    "periodLabel": "현재 4개월 / 6개월",
    "isComplete": false,
    "scanRate": 103.8,
    "totalScan": 3500,
    "campaigns": [
      {
        "round": 1,
        "scanCount": 1250,
        "scanRate": 108.0
      },
      {
        "round": 2,
        "scanCount": 1450,
        "scanRate": 102.5
      },
      {
        "round": 3,
        "scanCount": 800,
        "scanRate": 101.2
      }
    ]
  },
  "gradeRequirements": {
    "bronze": { "max": 79 },
    "silver": { "min": 80, "max": 99 },
    "gold": { "min": 100, "max": 114 },
    "platinum": { "min": 115 }
  },
  "currentLevel": "gold"
}
```


**2.3.2.2.** 내부 계산 로직  

↳ 아래 계산 방식은 시스템 내부 처리이며 화면에 표시되지 않음  

1: 벤치마크 대비 스캔율 계산  
　A. 스캔율 = (내 매장 스캔 수 / 벤치마크 평균 스캔 수) × 100  
　B. 벤치마크 평균 = 동일 캠페인 참여 전체 매장의 평균 스캔 수  

2: 누적 스캔율 계산  
　A. 산정 기간 내 모든 캠페인의 가중 평균  
　B. 각 캠페인별 스캔 수 / 각 캠페인별 벤치마크 평균 스캔 수의 가중합  


**2.3.2.3.** 컴포넌트 구현  

1: 렌더링 방식  
　A. 정보 표시 전용 (읽기 전용 컴포넌트)  
　B. 클릭 이벤트 핸들러 없음  
　C. 상태 관리 불필요 (인터랙션 없음)  

2: 프로그래스 바 색상 분기  

```javascript
const getScanRateColor = (rate) => {
  if (rate >= 115) return '#22C55E'; // 초록 (플래티넘)
  if (rate >= 100) return '#3B82F6'; // 파랑 (골드)
  if (rate >= 80) return '#F59E0B';  // 주황 (실버)
  return '#EF4444';                   // 빨강 (브론즈)
};
```

3: 캠페인 미참여 시 처리  
　A. hasCampaign === false인 경우 weekly, currentCampaign 영역 숨김  
　B. cumulative 영역만 렌더링  

4: 회차별 정보 레이아웃  
　A. 가로 배치 우선: flex-wrap 적용  
　B. 화면 너비 부족 시 자동 세로 전환  

5: 프로그래스 바 제목 분기  

```javascript
const getCumulativeTitle = (periodLabel, isComplete) => {
  if (isComplete) {
    // 산정 기간 완료: "6개월 누적 스캔율"
    return periodLabel + ' 누적 스캔율';
  }
  // 산정 기간 진행 중: "현재 4개월 / 6개월 누적 스캔율"
  return periodLabel + ' 누적 스캔율';
};
```

6: 등급 기준 달성 여부 렌더링  
　A. cumulative.scanRate와 gradeRequirements 비교  
　B. 달성: 초록색 체크 아이콘 + "달성"  
　C. 미달성: 빨간색 X 아이콘 + "미달성"  


**2.3.2.4.** 실시간 데이터 연동  

1: WebSocket 이벤트  
　A. scan.realtime: 소비자 QR 스캔 시 즉시 반영  
　　a. 오늘 스캔 횟수 실시간 증가  
　　b. 이번주 스캔 횟수 실시간 갱신  
　　c. 현재 캠페인 스캔율 실시간 재계산  
　B. grade.scan_cumulative: 등급 산정 기간 누적 스캔율 갱신 (일 1회 배치 집계)  

2: 이벤트 페이로드  

```json
// scan.realtime (소비자 QR 스캔 시 즉시 발행)
{
  "type": "scan_realtime",
  "campaignId": "CMP-2026-001",
  "timestamp": "2026-01-25T14:32:15Z",
  "updatedCounts": {
    "todayScan": 46,
    "weekScan": 313,
    "currentCampaignScan": 1251,
    "scanRate": 105.3,
    "benchmarkAvgScan": 1188
  }
}
```

3: 연결 정보  
　A. 엔드포인트: wss://api.withfom.com/partner/grade/status/realtime  
　B. 인증: JWT 토큰 기반 연결  

4: 실시간 반영 처리  
　A. scan.realtime 수신 시 이번주/현재 캠페인 프로그래스 바 즉시 업데이트  
　B. 프로그래스 바 너비 및 수치 애니메이션 (200ms, ease-out)  
　C. 누적 스캔율은 일 배치 집계 시점에 갱신 (실시간 반영 대상 아님)  


**2.3.2.5.** 접근성 요구사항  

1: 프로그래스 바 ARIA  
　A. role="progressbar"  
　B. aria-valuenow="{현재값}"  
　C. aria-valuemin="0"  
　D. aria-valuemax="200"  
　E. aria-label="스캔율 진행률"  

2: 달성 여부 ARIA  
　A. role="status"  
　B. aria-label="등급 기준 달성 여부: {달성/미달성}"  


**2.3.2.6.** 에러 처리  

1: 에러 코드  
　A. GRS_003: 스캔율 조회 실패  

2: 사용자 메시지  
　A. "스캔율 정보를 불러오지 못했습니다"  
　B. 재시도 버튼 표시 (유일한 인터랙션: 데이터 재조회)  


**2.3.2.7.** 성능 최적화  

1: 캐싱  
　A. 세션 스토리지에 30분 캐싱  
　B. 페이지 진입 시 캐시 유효성 확인 후 API 호출  

2: 프로그래스 바 애니메이션  
　A. 초기 로딩 시 CSS transition으로 너비 채움 (500ms, ease-out)  
　B. 뷰포트 진입 시 애니메이션 시작 (Intersection Observer)  


• 참조: 7-2-4-2 > 2.2.2. 개발자 인터랙션 명세
