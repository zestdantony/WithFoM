**5.6.** 개발자 인터랙션 명세  


**5.6.1.** 실시간 데이터 연동  

**5.6.1.1.** WebSocket 연결 (오더형/복합형)  
1: 연결 엔드포인트  
　A. wss://api.withfom.com/partner/dashboard/realtime  
　B. 인증: JWT 토큰 기반 연결  
2: 이벤트 수신  
　A. dashboard.order_updated: 주문 현황 갱신  
　B. dashboard.revenue_updated: 매출 현황 갱신  
　C. dashboard.category_updated: 카테고리별 판매 갱신  
　D. dashboard.daily_reset: 일일 초기화 완료  
3: 연결 유지  
　A. Heartbeat 간격: 30초  
　B. 연결 끊김 시 자동 재연결 (최대 5회, 간격 2초씩 증가)  


**5.6.2.** API 명세  

**5.6.2.1.** 주문 현황 조회 (대시보드용)  
1: 엔드포인트  
　A. GET /api/v1/partner/dashboard/order-summary  
2: 요청 파라미터  
　A. date (optional): 조회 기준일 (기본값: 오늘)  
3: 응답 구조  

```json
{
  "orderSummary": {
    "dineIn": {
      "orderCount": 28,
      "itemCount": 45
    },
    "takeOut": {
      "orderCount": 17,
      "itemCount": 27
    },
    "total": {
      "orderCount": 45,
      "itemCount": 72
    },
    "yesterdaySameTimeOrderCount": 40,
    "changeRate": 12.5,
    "changeDirection": "up",
    "lastUpdatedAt": "2026-01-28T14:35:00Z"
  },
  "categorySummary": {
    "categories": [
      {
        "categoryId": "coffee",
        "categoryName": "커피",
        "unit": "잔",
        "dineIn": 32,
        "takeOut": 18,
        "total": 50
      },
      {
        "categoryId": "non_coffee",
        "categoryName": "논커피",
        "unit": "잔",
        "dineIn": 8,
        "takeOut": 5,
        "total": 13
      },
      {
        "categoryId": "dessert",
        "categoryName": "디저트",
        "unit": "개",
        "dineIn": 6,
        "takeOut": 3,
        "total": 9
      }
    ],
    "totalSales": 72,
    "lastUpdatedAt": "2026-01-28T14:35:00Z"
  },
  "revenueSummary": {
    "todayOriginalAmount": 1450000,
    "todayRewardDiscount": 200000,
    "todayFinalAmount": 1250000,
    "yesterdaySameTimeFinalAmount": 1150000,
    "changeRate": 8.7,
    "changeDirection": "up",
    "rewardBreakdown": {
      "couponDiscount": 150000,
      "pointUsed": 30000,
      "stampBenefitUsed": 20000
    },
    "lastUpdatedAt": "2026-01-28T14:35:00Z"
  },
  "serviceType": "combined",
  "businessStartTime": "09:00",
  "isEmpty": false
}
```


**5.6.2.2.** 주문 현황 상세 조회  
1: 엔드포인트  
　A. GET /api/v1/partner/dashboard/order-summary/detail  
2: 요청 파라미터  
　A. date: 조회 기준일  
　B. compareWith (optional): 비교 기준 (yesterday, lastWeek, lastMonth)  
3: 응답 구조  

```json
{
  "orderDetail": {
    "todayOrders": [
      {
        "orderId": "ORD-2026-0001234",
        "orderNumber": "0042",
        "orderType": "dineIn",
        "status": "completed",
        "itemCount": 2,
        "amount": 12000,
        "createdAt": "2026-01-28T10:25:00Z"
      }
    ],
    "hourlyBreakdown": [
      { 
        "hour": "09:00", 
        "dineIn": { "orderCount": 3, "itemCount": 5 },
        "takeOut": { "orderCount": 2, "itemCount": 3 }
      },
      { 
        "hour": "10:00", 
        "dineIn": { "orderCount": 7, "itemCount": 10 },
        "takeOut": { "orderCount": 5, "itemCount": 8 }
      }
    ],
    "statusBreakdown": {
      "pending": 2,
      "preparing": 3,
      "ready": 5,
      "completed": 35,
      "cancelled": 0
    }
  }
}
```


**5.6.3.** 컴포넌트 상태 관리  

**5.6.3.1.** 데이터 상태 정의  
1: 로딩 상태 (loadingState)  
　A. idle: 초기 상태  
　B. loading: 데이터 로드 중  
　C. success: 데이터 로드 완료  
　D. error: 데이터 로드 실패  
2: 데이터 출처 (dataSource)  
　A. realtime: 실시간 WebSocket 연동 (오더형/복합형)  
　B. manual: 수동 입력 기반 (리워드형)  
　C. mixed: 혼합 (일부 자동, 일부 수동)  

**5.6.3.2.** 서비스 타입별 처리  
1: 오더형/복합형  

```javascript
const OrderSummarySection = ({ serviceType }) => {
  const isOrderEnabled = serviceType === 'order' || serviceType === 'combined';
  
  if (isOrderEnabled) {
    // 실시간 WebSocket 연결
    useWebSocketConnection('/dashboard/realtime');
  }
  
  return (
    <Section>
      <OrderCard enabled={isOrderEnabled} />
      <CategoryCard enabled={isOrderEnabled} />
      <RevenueCard enabled={isOrderEnabled} />
    </Section>
  );
};
```

2: 리워드형  

```javascript
const EmptyStateCard = ({ type, onEnableOrder }) => (
  <Card onClick={onEnableOrder}>
    <Icon name="order-disabled" />
    <Text>위드폼 오더를 이용하면 {type}을 실시간으로 확인할 수 있습니다</Text>
    <Button variant="link">오더 기능 활성화</Button>
  </Card>
);
```


**5.6.4.** 실시간 갱신 처리  

**5.6.4.1.** WebSocket 이벤트 핸들링  
1: 주문 현황 갱신  

```javascript
const handleOrderUpdate = (event) => {
  if (event.type === 'dashboard.order_updated') {
    setOrderSummary(prev => ({
      ...prev,
      dineIn: event.data.dineIn,
      takeOut: event.data.takeOut,
      total: event.data.total,
      lastUpdatedAt: new Date()
    }));
  }
};
```

2: 카테고리별 판매 갱신  

```javascript
const handleCategoryUpdate = (event) => {
  if (event.type === 'dashboard.category_updated') {
    setCategorySummary(prev => ({
      ...prev,
      categories: event.data.categories,
      totalSales: event.data.totalSales,
      lastUpdatedAt: new Date()
    }));
  }
};
```

3: 일일 초기화 처리  

```javascript
const handleDailyReset = (event) => {
  if (event.type === 'dashboard.daily_reset') {
    // 모든 "오늘" 데이터 초기화
    setOrderSummary({
      dineIn: { orderCount: 0, itemCount: 0 },
      takeOut: { orderCount: 0, itemCount: 0 },
      total: { orderCount: 0, itemCount: 0 },
      changeRate: null,
      lastUpdatedAt: new Date()
    });
    setCategorySummary({
      categories: [],
      totalSales: 0,
      lastUpdatedAt: new Date()
    });
    setRevenueSummary({
      todayFinalAmount: 0,
      todayRewardDiscount: 0,
      lastUpdatedAt: new Date()
    });
  }
};
```


**5.6.5.** 에러 처리  

**5.6.5.1.** 에러 코드 정의  
1: 에러 코드  
　A. DSH_001: 데이터 조회 실패  
　B. DSH_002: 실시간 연결 실패  
　C. DSH_003: 권한 없음  
　D. DSH_004: 서비스 타입 불일치  

**5.6.5.2.** 에러 처리 방식  
1: API 호출 실패  
　A. 자동 재시도: 3회, 간격 2초  
　B. 실패 시 에러 상태 표시  
　C. "데이터를 불러오는 데 실패했습니다" 메시지  
　D. [새로고침] 버튼 제공  
2: WebSocket 연결 실패  
　A. 폴링 방식으로 전환 (30초 간격)  
　B. 연결 복구 시 WebSocket으로 재전환  


**5.6.6.** 접근성 요구사항  

**5.6.6.1.** ARIA 레이블  
1: 섹션 영역  
　A. role="region"  
　B. aria-label="주문 현황 섹션"  
2: 카드 영역  
　A. role="button" (클릭 가능)  
　B. aria-label="주문 현황: 오늘 45건 (매장 28건, 테이크아웃 17건)"  
3: 통계 수치  
　A. aria-live="polite" (실시간 업데이트 알림)  

**5.6.6.2.** 키보드 내비게이션  
1: Tab 순서  
　A. 섹션 제목 → 전체 보기 링크 → 주문 카드 → 카테고리 카드 → 매출 카드  
2: 단축키  
　A. Enter: 선택된 카드 클릭  
　B. Space: 선택된 카드 클릭  


**5.6.7.** 성능 최적화  

**5.6.7.1.** 렌더링 최적화  
1: 컴포넌트 구조  
　A. React.memo 적용으로 불필요한 리렌더링 방지  
　B. 각 카드 컴포넌트 독립적으로 업데이트  
2: 데이터 갱신  
　A. 변경된 데이터만 선택적 업데이트  
　B. 디바운싱 적용 (동시 다발적 업데이트 방지)  

**5.6.7.2.** 데이터 캐싱  
1: 캐싱 전략  
　A. 대시보드 데이터: 메모리 캐시 (세션 동안 유지)  
　B. 실시간 업데이트 시 캐시 갱신  
　C. 페이지 이탈 후 복귀 시: 캐시 데이터 표시 → 백그라운드 갱신  


**5.6.8.** 일일 초기화 처리  

**5.6.8.1.** 초기화 로직  
1: 서버 트리거  
　A. 매장 영업 시작 시간에 맞춰 서버에서 자동 초기화  
　B. WebSocket 이벤트로 클라이언트에 알림  
2: 클라이언트 처리  

```javascript
// 일일 초기화 이벤트 수신
const handleDailyReset = (event) => {
  // 대시보드 요약 데이터 초기화
  resetDashboardSummary();
  
  // 어제 데이터로 비교 기준 업데이트
  setYesterdayData(event.previousDayData);
  
  // 토스트 메시지 (선택적)
  showToast('새로운 영업일이 시작되었습니다', 'info');
};
```


• 참조: 7-2-9. 주문 관리 > 개발자 명세, 7-2-10. 결제 관리 > 개발자 명세
