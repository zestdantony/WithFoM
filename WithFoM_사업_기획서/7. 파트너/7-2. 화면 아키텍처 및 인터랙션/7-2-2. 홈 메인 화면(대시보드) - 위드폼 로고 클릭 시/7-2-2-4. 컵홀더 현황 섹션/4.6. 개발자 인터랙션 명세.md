**4.6.** 개발자 인터랙션 명세  


**4.6.1.** 데이터 연동 방식  

**4.6.1.1.** WebSocket 연결 (일일 컵홀더 소진량)  
1: 연결 엔드포인트  
　A. wss://api.withfom.com/partner/dashboard/realtime  
　B. 인증: JWT 토큰 기반 연결  
2: 이벤트 수신  
　A. dashboard.takeout_order_completed: 테이크 아웃 주문 완료 시  
　B. dashboard.cupholder_updated: 소진량 갱신  
　C. dashboard.daily_reset: 일일 초기화 완료  
3: 연결 유지  
　A. Heartbeat 간격: 30초  
　B. 연결 끊김 시 자동 재연결 (최대 5회)  

**4.6.1.2.** REST API (기타 카드)  
1: 캠페인/입고 정보  
　A. 입고 완료 시 갱신  
　B. 폴링 간격: 필요 없음 (이벤트 기반)  
2: 소진 보고율/QR 스캔율  
　A. 페이지 로드 시 조회  
　B. 일일 단위 갱신  


**4.6.2.** API 명세  

**4.6.2.1.** 컵홀더 현황 조회 (대시보드용)  
1: 엔드포인트  
　A. GET /api/v1/partner/dashboard/cupholder-summary  
2: 요청 파라미터  
　A. campaignId (optional): 특정 캠페인 조회 (기본값: 현재 활성 캠페인)  
3: 응답 구조  

```json
{
  "campaignSummary": {
    "campaignId": "CAMP-2026-003",
    "campaignName": "OO브랜드 신제품 런칭",
    "round": 3,
    "totalQuantity": 3000,
    "cumulativeReceived": 2000,
    "remainingToReceive": 1000,
    "progressRate": 66.7,
    "startDate": "2026-01-15",
    "endDate": "2026-02-14"
  },
  "currentReceiptSummary": {
    "receiptNumber": 2,
    "totalReceived": 500,
    "cumulativeConsumed": 320,
    "remainingStock": 180,
    "todayConsumed": 42,
    "todayReportStatus": "reported",
    "stockLevel": "normal",
    "progressRate": 64.0
  },
  "dailyTakeoutConsumption": {
    "todayCount": 127,
    "dataSource": "auto_calculate",
    "lastUpdatedAt": "2026-01-28T14:35:00Z",
    "reportedValue": 130,
    "difference": 3
  },
  "reportRate": {
    "currentRound": {
      "round": 3,
      "rate": 92.0,
      "reportedDays": 23,
      "totalCampaignDays": 25
    },
    "gradingPeriod": {
      "partnerGrade": "gold",
      "periodMonths": 6,
      "rate": 95.0,
      "reportedDays": 110,
      "totalCampaignDays": 116,
      "excludedDays": 14,
      "periodUnit": "monthly",
      "periodDescription": "최근 6개월 (캠페인 진행 기간 기준)"
    }
  },
  "consumptionStats": {
    "cumulativeConsumed": 1847,
    "totalAllocated": 3000,
    "progressRate": 61.6,
    "remainingQuantity": 1153,
    "remainingDays": 12,
    "dailyAverage": 118
  },
  "qrScanRate": {
    "currentRound": {
      "round": 3,
      "rate": 78.0,
      "benchmarkComparison": "above",
      "percentileRank": 75,
      "rankDescription": "상위 25%",
      "comparisonTarget": "동일 캠페인 진행 매장"
    },
    "gradingPeriod": {
      "partnerGrade": "gold",
      "periodMonths": 6,
      "rate": 82.0,
      "benchmarkComparison": "above",
      "percentileRank": 80,
      "rankDescription": "상위 20%",
      "periodUnit": "monthly",
      "comparisonTarget": "산정 기간 내 동일 캠페인 진행 매장",
      "roundsIncluded": [1, 2, 3],
      "roundRates": [
        { "round": 1, "rate": 80.5 },
        { "round": 2, "rate": 83.2 },
        { "round": 3, "rate": 78.0 }
      ],
      "periodDescription": "최근 6개월 (각 회차 스캔율 종합)"
    },
    "scanCounts": {
      "todayScans": 32,
      "currentRoundScans": 856,
      "roundLabel": "3회차 누적"
    }
  },
  "serviceType": "combined",
  "isOrderEnabled": true
}
```


**4.6.2.2.** 일일 테이크 아웃 소진량 조회  
1: 엔드포인트  
　A. GET /api/v1/partner/dashboard/daily-takeout-consumption  
2: 요청 파라미터  
　A. date (optional): 조회 기준일 (기본값: 오늘)  
3: 응답 구조  

```json
{
  "dailyTakeoutConsumption": {
    "date": "2026-01-28",
    "count": 127,
    "hourlyBreakdown": [
      { "hour": "09:00", "count": 8 },
      { "hour": "10:00", "count": 15 },
      { "hour": "11:00", "count": 22 },
      { "hour": "12:00", "count": 28 },
      { "hour": "13:00", "count": 18 },
      { "hour": "14:00", "count": 20 }
    ],
    "lastUpdatedAt": "2026-01-28T14:35:00Z"
  },
  "comparison": {
    "reportedValue": null,
    "difference": null,
    "reportStatus": "pending"
  },
  "reference": {
    "yesterdayCount": 118,
    "weeklyAverage": 125,
    "monthlyAverage": 120
  }
}
```


**4.6.3.** 컴포넌트 상태 관리  

**4.6.3.1.** 데이터 상태 정의  
1: 로딩 상태 (loadingState)  
　A. idle: 초기 상태  
　B. loading: 데이터 로드 중  
　C. success: 데이터 로드 완료  
　D. error: 데이터 로드 실패  
2: 재고 수준 (stockLevel)  
　A. normal: 정상 (20% 초과)  
　B. low: 부족 (10~20%)  
　C. critical: 긴급 (10% 이하)  

**4.6.3.2.** 서비스 타입별 처리  
1: 오더형/복합형  

```javascript
const CupholderSection = ({ serviceType }) => {
  const isOrderEnabled = serviceType === 'order' || serviceType === 'combined';
  
  if (isOrderEnabled) {
    // 일일 테이크 아웃 소진량 실시간 연결
    useWebSocketConnection('/dashboard/realtime');
  }
  
  return (
    <Section>
      <CampaignCard />
      <ReceiptCard />
      <DailyTakeoutCard enabled={isOrderEnabled} />
      <ReportRateCard />
      <QRScanCard />
    </Section>
  );
};
```

2: 리워드형  

```javascript
const DailyTakeoutCard = ({ enabled }) => {
  if (!enabled) {
    return (
      <Card>
        <Icon name="auto-disabled" />
        <Text>위드폼 오더를 이용하면 테이크 아웃 소진량을 자동으로 확인할 수 있습니다</Text>
        <Button variant="link">오더 기능 활성화</Button>
      </Card>
    );
  }
  
  return (
    <Card>
      <Title>오늘 소진량 (테이크 아웃)</Title>
      <Badge>자동 계산</Badge>
      <Value>{dailyCount}개</Value>
      <UpdateTime>최종 갱신: {lastUpdated}</UpdateTime>
    </Card>
  );
};
```


**4.6.4.** 실시간 갱신 처리  

**4.6.4.1.** WebSocket 이벤트 핸들링  
1: 테이크 아웃 주문 완료 시  

```javascript
const handleTakeoutOrderCompleted = (event) => {
  if (event.type === 'dashboard.takeout_order_completed') {
    setDailyTakeoutCount(prev => prev + 1);
    setLastUpdatedAt(new Date());
  }
};
```

2: 일일 초기화 처리  

```javascript
const handleDailyReset = (event) => {
  if (event.type === 'dashboard.daily_reset') {
    // 일일 테이크 아웃 소진량 초기화
    setDailyTakeoutCount(0);
    setLastUpdatedAt(new Date());
    
    // 보고 상태 초기화
    setReportStatus('pending');
    setReportedValue(null);
  }
};
```


**4.6.5.** 에러 처리  

**4.6.5.1.** 에러 코드 정의  
1: 에러 코드  
　A. CUP_001: 캠페인 정보 조회 실패  
　B. CUP_002: 입고 정보 조회 실패  
　C. CUP_003: 실시간 연결 실패  
　D. CUP_004: 서비스 타입 불일치  
　E. CUP_005: 캠페인 매칭 대기 중  

**4.6.5.2.** 에러 처리 방식  
1: API 호출 실패  
　A. 자동 재시도: 3회, 간격 2초  
　B. 실패 시 에러 상태 표시  
　C. [새로고침] 버튼 제공  
2: WebSocket 연결 실패  
　A. 폴링 방식으로 전환 (60초 간격)  
　B. 연결 복구 시 WebSocket으로 재전환  


**4.6.6.** 접근성 요구사항  

**4.6.6.1.** ARIA 레이블  
1: 섹션 영역  
　A. role="region"  
　B. aria-label="컵홀더 현황 섹션"  
2: 카드 영역  
　A. role="button" (클릭 가능)  
　B. aria-label="N회차 캠페인: 총 3,000개 중 2,000개 입고"  
3: 재고 상태  
　A. aria-live="polite" (재고 부족 알림)  

**4.6.6.2.** 키보드 내비게이션  
1: Tab 순서  
　A. 섹션 제목 → 전체 보기 → 캠페인 카드 → 입고 카드 → 소진량 카드 → 보고율 카드 → QR 카드  
2: 단축키  
　A. Enter: 선택된 카드 클릭  
　B. Space: 선택된 카드 클릭  


**4.6.7.** 성능 최적화  

**4.6.7.1.** 렌더링 최적화  
1: 컴포넌트 구조  
　A. React.memo 적용으로 불필요한 리렌더링 방지  
　B. 각 카드 컴포넌트 독립적으로 업데이트  
2: 데이터 갱신  
　A. 일일 테이크 아웃 카운트만 실시간 갱신  
　B. 기타 카드는 이벤트 기반 갱신  

**4.6.7.2.** 데이터 캐싱  
1: 캐싱 전략  
　A. 캠페인/입고 정보: 5분 캐시  
　B. 소진 보고율: 1시간 캐시  
　C. QR 스캔율: 1시간 캐시  
　D. 일일 테이크 아웃: 캐시 없음 (실시간)  


**4.6.8.** 일일 초기화 처리  

**4.6.8.1.** 초기화 로직  
1: 서버 트리거  
　A. 매장 영업 시작 시간에 맞춰 서버에서 자동 초기화  
　B. WebSocket 이벤트로 클라이언트에 알림  
2: 초기화 대상  
　A. 일일 테이크 아웃 소진량 → 0으로 리셋  
　B. 오늘 소진 수 (보고 기준) → 미보고 상태로 변경  
3: 유지 대상  
　A. 캠페인/입고 누적 데이터  
　B. 소진 보고율/QR 스캔율 통계  


• 참조: 7-2-5. 캠페인 관리 > 개발자 명세, 7-2-2-3. 일일 소진 보고 섹션 > 개발자 명세
