<!-- WF:DOC=DEV -->
**3.4.** 개발자 인터랙션 명세  

본 문서는 게임 통계 페이지(3.0.~3.3.)의 모든 비즈니스 요구사항을 개발 구현 관점에서 정리한다.  


**3.4.1.** API 명세  


**3.4.1.1.** 게임 참여 현황 조회  

1: 엔드포인트  
　A. `GET /api/v1/partner/game/statistics/participation`  
　B. 인증: Bearer Token(파트너 세션)  
　C. 권한: 게임 관리 > 게임 통계 조회  

2: 요청 쿼리 파라미터  

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| preset | string | N | today \| week \| month \| custom. 기본값: today |
| startDate | string | N | YYYY-MM-DD (preset=custom 시 필수) |
| endDate | string | N | YYYY-MM-DD (preset=custom 시 필수) |

3: 응답 JSON  

```json
{
  "summary": {
    "totalPlays": 127,
    "paidPlays": 89,
    "freePlays": 38,
    "totalWins": 108
  },
  "dailyTrend": [
    {
      "date": "2026-02-01",
      "paidPlays": 30,
      "freePlays": 12,
      "wins": 35
    },
    {
      "date": "2026-02-02",
      "paidPlays": 28,
      "freePlays": 14,
      "wins": 33
    }
  ],
  "advertiserGame": {
    "enabled": true,
    "qrParticipations": 45,
    "partnerRewardWins": 7
  }
}
```

4: 응답 필드 매핑  
　A. `summary.totalPlays` → 3.1.1.1. 카드 A "총 참여 횟수"  
　B. `summary.paidPlays` → 3.1.1.1. 카드 B "유료 참여"  
　C. `summary.freePlays` → 3.1.1.1. 카드 C "무료 참여"  
　D. `summary.totalWins` → 3.1.1.1. 카드 D "당첨 건수" (꽝 제외)  
　E. `dailyTrend[]` → 3.1.2.2. 참여 추이 라인 차트 데이터  
　F. `dailyTrend[].paidPlays` → 차트 파랑 라인  
　G. `dailyTrend[].freePlays` → 차트 초록 라인  
　H. `advertiserGame.enabled` → false 시 광고주 게임 영역 전체 숨김  
　I. `advertiserGame.qrParticipations` → 3.1.1.1. 2항 A "QR 참여 횟수"  
　J. `advertiserGame.partnerRewardWins` → 3.1.1.1. 2항 B "7등 당첨 횟수"  

5: 에러  
　A. 401: 미인증  
　B. GS_001: 참여 현황 조회 실패  


**3.4.1.2.** 리워드 당첨·소진 현황 조회  

1: 엔드포인트  
　A. `GET /api/v1/partner/game/statistics/reward-analysis`  
　B. 인증: Bearer Token(파트너 세션)  
　C. 권한: 게임 관리 > 게임 통계 조회  

2: 요청 쿼리 파라미터  

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| preset | string | N | today \| week \| month \| custom. 기본값: today |
| startDate | string | N | YYYY-MM-DD (preset=custom 시 필수) |
| endDate | string | N | YYYY-MM-DD (preset=custom 시 필수) |

3: 응답 JSON  

```json
{
  "winAnalysis": [
    {
      "rewardId": "rw_001",
      "rewardName": "아메리카노 무료 쿠폰",
      "rank": 1,
      "winCount": 12,
      "configuredRate": 5.0,
      "actualRate": 4.8,
      "deviation": -0.2,
      "isDepleted": false
    },
    {
      "rewardId": "rw_002",
      "rewardName": "10% 할인 쿠폰",
      "rank": 2,
      "winCount": 25,
      "configuredRate": 10.0,
      "actualRate": 10.2,
      "deviation": 0.2,
      "isDepleted": false
    },
    {
      "rewardId": "rw_003",
      "rewardName": "포인트 500P",
      "rank": 3,
      "winCount": 40,
      "configuredRate": 15.0,
      "actualRate": 16.3,
      "deviation": 1.3,
      "isDepleted": true
    },
    {
      "rewardId": "blank",
      "rewardName": "꽝",
      "rank": null,
      "winCount": 67,
      "configuredRate": 50.0,
      "actualRate": 51.1,
      "deviation": 1.1,
      "isDepleted": false
    }
  ],
  "depletionStatus": [
    {
      "rewardId": "rw_001",
      "rewardName": "아메리카노 무료 쿠폰",
      "rank": 1,
      "totalQuantity": 100,
      "remainingQuantity": 67,
      "depletionPercent": 33.0,
      "avgDailyConsumption": 4.7,
      "estimatedDaysRemaining": 14,
      "estimatedDepletionDate": "2026-02-18",
      "status": "NORMAL"
    },
    {
      "rewardId": "rw_002",
      "rewardName": "10% 할인 쿠폰",
      "rank": 2,
      "totalQuantity": 200,
      "remainingQuantity": 174,
      "depletionPercent": 13.0,
      "avgDailyConsumption": 3.7,
      "estimatedDaysRemaining": 47,
      "estimatedDepletionDate": "2026-03-23",
      "status": "NORMAL"
    },
    {
      "rewardId": "rw_003",
      "rewardName": "포인트 500P",
      "rank": 3,
      "totalQuantity": 50,
      "remainingQuantity": 0,
      "depletionPercent": 100.0,
      "avgDailyConsumption": 0,
      "estimatedDaysRemaining": 0,
      "estimatedDepletionDate": null,
      "status": "DEPLETED"
    }
  ],
  "totalDepletionWarning": {
    "totalQuantity": 350,
    "totalRemaining": 241,
    "remainingPercent": 68.9,
    "isWarning": false
  },
  "replenishmentHistory": [
    {
      "date": "2026-01-15T14:30:00Z",
      "addedQuantity": 500,
      "totalAfter": 800
    },
    {
      "date": "2026-02-01T09:00:00Z",
      "addedQuantity": 300,
      "totalAfter": 650
    }
  ],
  "advertiser7thRank": {
    "enabled": true,
    "campaigns": [
      {
        "campaignId": "camp_001",
        "campaignName": "스타벅스 신메뉴 캠페인",
        "rewardName": "10% 할인 쿠폰",
        "winCount": 7,
        "usedCount": 5,
        "usageRate": 71.4
      }
    ]
  }
}
```

4: 응답 필드 매핑  

　A. `winAnalysis[]` → 3.2.1.1. 도넛 차트 데이터 + 3.2.1.2. 당첨 상세 테이블  
　　① `rewardName` → 테이블 컬럼 A "리워드명"  
　　② `rank` → 테이블 컬럼 B "등수" (null 이면 "꽝")  
　　③ `winCount` → 테이블 컬럼 C "당첨 횟수"  
　　④ `configuredRate` → 테이블 컬럼 D "설정 확률(%)"  
　　⑤ `actualRate` → 테이블 컬럼 E "실제 비율(%)"  
　　⑥ `deviation` → 테이블 컬럼 F "차이" (양수: △, 음수: ▽, |deviation| ≤ 2.0% 시: ≈ 표시)  
　　⑦ `isDepleted` → true 시 행 회색 처리 + "소진" 배지 (3.2.1.2. 2항)  
　　⑧ `rewardId = "blank"` → 꽝 항목. 게임의 blank.enabled=false 시 winAnalysis 배열에서 꽝 항목 미포함(서버에서 제외)  
　　⑨ 소진 리워드 확률 재분배 주의: 리워드 소진 시 해당 리워드의 configuredRate는 원래 설정값을 유지하되, actualRate는 재분배 후 실제 당첨 비율로 표시. deviation이 클 수 있으므로 UI에 "소진된 리워드의 확률이 재분배되어 차이가 발생할 수 있습니다" 안내 표시 → 1.2.2.2. 9항 확률 재분배 참조  

　B. `depletionStatus[]` → 3.2.2.1. 소진 프로그레스 바  
　　① `remainingQuantity / totalQuantity` → 프로그레스 바 비율  
　　② `status` 값에 따른 색상  
　　　• `NORMAL` (잔여 > 10%): 파랑  
　　　• `WARNING` (잔여 ≤ 10%): 주황  
　　　• `DEPLETED` (잔여 = 0): 빨강 + "소진" 배지  
　　　• `INSUFFICIENT_DATA` (운영 7일 미만): "데이터 수집 중" 표시  
　　③ `estimatedDaysRemaining` → 3.2.2.2. "약 N일 후 소진 예상"  
　　④ `estimatedDepletionDate` → 3.2.2.2. "(M월 D일)"  

　C. `totalDepletionWarning` → 3.2.2.2. 2항 C 경고 배너  
　　① `isWarning` = true (remainingPercent ≤ 10) 시 경고 배너 표시  
　　② 배너 메시지: "리워드 총량이 10% 이하입니다. 보충을 권장합니다."  

　D. `replenishmentHistory[]` → 3.2.2.3. 보충 이력  
　　① `date` → 보충 일시  
　　② `addedQuantity` → 보충 수량  
　　③ `totalAfter` → 보충 후 총량  
　　④ 최대 5건 표시, 빈 배열 시 "보충 이력이 없습니다" 표시  

　E. `advertiser7thRank` → 3.2.3.1. 광고주 7등 리워드 현황  
　　① `enabled` → false 시 3.2.3. 영역 전체 숨김  
　　② `campaigns[].campaignName` → 활성 캠페인명  
　　③ `campaigns[].rewardName` → 7등 리워드명  
　　④ `campaigns[].winCount` → 누적 당첨 건수  
　　⑤ `campaigns[].usedCount` → 당첨 후 실제 사용 건수  
　　⑥ `campaigns[].usageRate` → 사용률(%)  

5: 에러  
　A. 401: 미인증  
　B. GS_002: 리워드 분석 조회 실패  


**3.4.2.** 컴포넌트 구현 참고  


**3.4.2.1.** 기간 필터 상태 관리  

1: 기간 선택 UI  
　A. 페이지 상단에 기간 선택 컨트롤 배치  
　B. 기간 변경 시 3.4.1.1. + 3.4.1.2. 두 API 동시 호출  
　C. 선택된 기간은 페이지 상태로 관리하여 두 API가 동일 기간 조회  

2: 기간 직접 선택  
　A. preset=custom 시 달력 UI 표시  
　B. 시작일·종료일 입력 후 조회 버튼 클릭 시 데이터 갱신  


**3.4.2.2.** 참여 추이 라인 차트  

1: 차트 구현  
　A. `dailyTrend[]` 배열을 X축(날짜)·Y축(횟수) 라인 차트로 렌더링  
　B. 유료(`paidPlays`) 라인: 파랑 색상  
　C. 무료(`freePlays`) 라인: 초록 색상  
　D. 기간에 따라 X축 단위 자동 조절 (7일 이내: 일별, 30일 초과: 주별)  
　E. 호버 시 해당 날짜의 유료·무료·당첨 수치 툴팁 표시  


**3.4.2.3.** 당첨 비율 도넛 차트  

1: 차트 구현  
　A. `winAnalysis[]` 배열의 `actualRate` 값으로 도넛 차트 렌더링  
　B. 등수별 색상 구분 (1등: 골드, 2등: 실버, 3등: 브론즈, 4~6등: 계열 색상, 꽝: 회색)  
　C. 차트 중앙에 총 참여 횟수(`summary.totalPlays`) 표시  
　D. 영역 클릭/호버 시 해당 리워드의 당첨 횟수·비율 툴팁 표시  
　E. `isDepleted=true`인 항목은 빗금 패턴으로 구분  


**3.4.2.4.** 소진 프로그레스 바  

1: 프로그레스 바 구현  
　A. `depletionStatus[]` 배열을 리워드별 가로 프로그레스 바로 렌더링  
　B. 바 채움: 소진량 비율 (`depletionPercent / 100`)  
　C. 색상 분기  
　　① `status = "NORMAL"`: 바 채움 파랑  
　　② `status = "WARNING"`: 바 채움 주황 + 텍스트 주황  
　　③ `status = "DEPLETED"`: 바 채움 빨강 + "소진" 배지  
　　④ `status = "INSUFFICIENT_DATA"`: 바 비활성 + "데이터 수집 중" 텍스트  
　D. 바 우측에 "N개 남음 (M%)" 텍스트 표시  
　E. 꽝 항목(`rank = null`)은 프로그레스 바 미표시, "무제한" 라벨만 표시. 꽝 OFF 시 winAnalysis에서 꽝 미포함이므로 해당 항목 자체가 없음  
　F. 전체 리워드 중 최단 소진 예상 항목(`estimatedDaysRemaining` 최소값)은 강조 표시 (테두리 또는 라벨 하이라이트)  

2: 경고 배너  
　A. `totalDepletionWarning.isWarning = true` 시 섹션 상단에 경고 배너 표시  
　B. 배너 색상: 주황 배경  
　C. 메시지: "리워드 총량이 10% 이하입니다. 보충을 권장합니다."  
　D. [리워드 보충] 버튼 배너 내 배치  


**3.4.2.5.** 광고주 게임 조건부 표시  

1: 표시 조건  
　A. `advertiserGame.enabled = false` 시 3.1.1.1. 2항 (광고주 오늘 현황) 숨김  
　B. `advertiser7thRank.enabled = false` 시 3.2.3. 영역 전체 숨김  
　C. 두 값 모두 false 시 광고주 관련 UI 요소 일체 미표시  

2: 활성 캠페인 미존재 시  
　A. `advertiser7thRank.campaigns` 빈 배열 시 "활성 캠페인이 없습니다" 안내 표시  


**3.4.2.6.** 바로가기 네비게이션  

1: 하단 바로가기 버튼 구성  
　A. [게임 설정]: 게임 설정(7-2-7-1) 게임 생성 섹션으로 라우팅  
　B. [리워드 보충]: 게임 설정(7-2-7-1) > 1.3. 리워드 적용·프리셋 관리 섹션으로 라우팅  
　C. [리워드 현황]: 리워드·스탬프 현황(7-2-8-1)으로 라우팅  
　D. [상세 분석 보기]: 매장 관리(7-2-6-3) 현황 탭으로 라우팅  

2: [리워드 보충] 버튼 별도 배치  
　A. 3.2.2. 소진 현황 영역 하단에 추가 배치  
　B. 경고 배너 내에도 포함 (3.4.2.4. 2항 D)  


**3.4.3.** 에러 코드 정의  


**3.4.3.1.** 게임 통계 에러 코드  

| 코드 | HTTP | 메시지 | 설명 |
|------|------|--------|------|
| GS_001 | 500 | 참여 현황 조회에 실패했습니다 | 참여 통계 데이터 조회 서버 오류 |
| GS_002 | 500 | 리워드 분석 조회에 실패했습니다 | 리워드 당첨·소진 데이터 조회 서버 오류 |
| GS_003 | 400 | 유효하지 않은 기간입니다 | preset=custom 시 startDate > endDate 또는 미래 날짜 |
| GS_004 | 400 | 조회 기간이 최대 범위를 초과합니다 | 최대 조회 기간 1년 초과 시 |

2: 공통 에러  
　A. 401: 미인증 → 로그인 페이지로 리다이렉트  
　B. 403: 권한 없음 → "게임 통계 조회 권한이 없습니다" 안내  
　C. 네트워크 오류 시: "데이터를 불러올 수 없습니다. 잠시 후 다시 시도해 주세요." 안내 + [재시도] 버튼  


• 참조: 3.0.~3.3., 7-2-7-1 > 1.6. 개발자 인터랙션 명세, 7-2-7-2 > 2.6. 개발자 인터랙션 명세  
