<!-- WF:DOC=DEV -->
**1.9.** 개발자 인터랙션 명세  


**1.9.1.** API 명세 — 파트너 자체 게임  


**1.9.1.1.** 현재 게임 조회 API  

1: 엔드포인트  
　A. `GET /api/v1/partner/game/current`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답 JSON  

```json
{
  "exists": true,
  "game": {
    "gameId": "g_abc123",
    "type": "ROULETTE",
    "typeLabel": "룰렛",
    "slotCount": 6,
    "name": "럭키 룰렛",
    "description": "행운을 시험해 보세요!",
    "theme": "THEME_01",
    "status": "ACTIVE",
    "createdAt": "2026-01-15",
    "appliedRewardCount": 4,
    "hasBlank": true
  },
  "typeChange": {
    "used": 0,
    "limit": 1,
    "unlimited": false,
    "resetsAt": "2026-02-01"
  }
}
```  

3: 응답 필드  
　A. `exists`: 게임 존재 여부 (false 시 `game` 객체 null)  
　B. `game.type`: ROULETTE | GACHA | SCRATCH | LADDER  
　C. `game.slotCount`: 유형별 고정 슬롯 수(6/12/16/6)  
　D. `game.status`: ACTIVE | INACTIVE  
　E. `game.appliedRewardCount`: 현재 적용 중인 리워드 수  
　F. `typeChange.used`: 이번 달 사용 횟수  
　G. `typeChange.limit`: 플랜별 월 한도(베이직 1, 플러스 2, 프리미엄 -1=무제한)  
　H. `typeChange.unlimited`: 프리미엄 무제한 여부  


**1.9.1.2.** 게임 생성 API  

1: 엔드포인트  
　A. `POST /api/v1/partner/game`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "type": "ROULETTE",
  "name": "럭키 룰렛",
  "description": "행운을 시험해 보세요!",
  "theme": "THEME_01"
}
```  

3: 요청 필드  
　A. `type`: ROULETTE | GACHA | SCRATCH | LADDER (필수)  
　B. `name`: 게임 이름 (최대 20자, 필수)  
　C. `description`: 게임 설명 (최대 50자, 선택)  
　D. `theme`: 테마 ID (필수)  

4: 응답  
　A. 성공: `{ "gameId": "g_abc123", "status": "INACTIVE", "slotCount": 6 }`  
　B. 이미 게임 존재: `{ "error": "GAME_ALREADY_EXISTS" }`  

5: 유의사항  
　A. 생성 직후 status는 INACTIVE(리워드 적용 전)  
　B. 리워드 적용 + 활성화 시 ACTIVE로 전환  


**1.9.1.3.** 게임 수정 API  

1: 엔드포인트  
　A. `PUT /api/v1/partner/game/{gameId}`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "name": "수정된 룰렛",
  "description": "새로운 설명",
  "theme": "THEME_02"
}
```  

3: 응답  
　A. 성공: `{ "gameId": "g_abc123", "updated": true }`  
　B. 게임 없음: `{ "error": "GAME_NOT_FOUND" }`  

4: 유의사항  
　A. 게임 유형(type)은 수정 불가(유형 변경은 삭제 후 재생성)  


**1.9.1.4.** 게임 삭제 API  

1: 엔드포인트  
　A. `DELETE /api/v1/partner/game/{gameId}`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답  
　A. 성공: `{ "deleted": true }`  
　B. 게임 없음: `{ "error": "GAME_NOT_FOUND" }`  

3: 유의사항  
　A. 삭제 시 적용 중인 리워드 복사본 함께 삭제  
　B. 저장 라이브러리·프리셋은 유지  
　C. typeChange 횟수 소모 없음(삭제 후 새 생성만 횟수 소모 아님, 유형 변경 시만 소모)  


**1.9.1.5.** 게임 유형 변경 API  

1: 엔드포인트  
　A. `POST /api/v1/partner/game/change-type`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "newType": "GACHA",
  "name": "캡슐 뽑기",
  "description": "캡슐을 뽑아보세요!",
  "theme": "THEME_01"
}
```  

3: 응답  
　A. 성공: `{ "gameId": "g_def456", "type": "GACHA", "slotCount": 12, "typeChange": { "used": 1, "limit": 1 } }`  
　B. 횟수 초과: `{ "error": "TYPE_CHANGE_LIMIT_EXCEEDED", "resetsAt": "2026-02-01" }`  
　C. 동일 유형: `{ "error": "SAME_TYPE_SELECTED" }`  

4: 유의사항  
　A. 기존 게임 자동 삭제 → 새 게임 생성 (트랜잭션)  
　B. typeChange.used 1 증가  
　C. 기존 적용 리워드 복사본 삭제  


**1.9.2.** API 명세 — 게임 리워드 구성  


**1.9.2.1.** 현재 게임 리워드 구성 조회 API  

1: 엔드포인트  
　A. `GET /api/v1/partner/game/{gameId}/rewards`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답 JSON  

```json
{
  "rewards": [
    {
      "activeRewardId": "ar_001",
      "sourceRewardId": "sr_100",
      "rank": 1,
      "type": "COUPON",
      "name": "10% 할인 쿠폰",
      "value": "10%",
      "probability": 5,
      "quantity": 100,
      "expiryType": "RELATIVE",
      "expiryDays": 30,
      "guidanceMessage": "축하합니다! 1등 당첨!",
      "conditions": { "minOrderAmount": 10000 }
    }
  ],
  "blank": {
    "enabled": true,
    "probability": 30,
    "message": "다음 기회에!"
  },
  "totalProbability": 100,
  "estimatedBudget": 250000,
  "estimatedMinRevenue": 500000
}
```  

3: 응답 필드  
　A. `rewards[].activeRewardId`: 게임 적용 복사본 고유 ID  
　B. `rewards[].sourceRewardId`: 원본 저장 라이브러리 리워드 ID (복사 원본 추적용, 삭제 시에도 유지)  
　C. `rewards[].rank`: 등수(1~6)  
　D. `rewards[].probability`: 당첨 확률(%)  
　E. `rewards[].quantity`: 총 발행 수량  
　F. `rewards[].expiryType`: RELATIVE(상대) | ABSOLUTE(절대)  
　G. `rewards[].guidanceMessage`: 게임 적용 시 안내 문구  
　H. `blank.enabled`: 꽝 포함 여부  


**1.9.2.2.** 게임 리워드 구성 업데이트 API (1.3. 편집기 반영용)  

1: 엔드포인트  
　A. `PUT /api/v1/partner/game/{gameId}/rewards`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "rewards": [
    {
      "activeRewardId": "ar_001",
      "rank": 1,
      "probability": 5,
      "quantity": 100
    },
    {
      "activeRewardId": null,
      "sourceRewardId": "sr_200",
      "rank": 2,
      "probability": 15,
      "quantity": 200
    }
  ],
  "blank": {
    "enabled": true,
    "probability": 30,
    "message": "다음 기회에!"
  }
}
```  

3: 요청 필드  
　A. `rewards[].activeRewardId`: 기존 복사본 ID (null이면 신규 추가 → sourceRewardId 필수)  
　B. `rewards[].sourceRewardId`: 라이브러리에서 새로 추가 시 원본 ID  
　C. 확률 합계 ≠ 100% 시 서버 거부: `{ "error": "PROBABILITY_SUM_INVALID" }`  

4: 응답  
　A. 성공: `{ "updated": true, "appliedRewardCount": 4 }`  
　B. 리워드 없음: `{ "error": "REWARD_NOT_FOUND", "rewardId": "sr_200" }`  


**1.9.2.3.** 게임 리워드 제거 API  

1: 엔드포인트  
　A. `DELETE /api/v1/partner/game/{gameId}/rewards/{activeRewardId}`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답  
　A. 성공: `{ "removed": true, "remainingCount": 3 }`  

3: 유의사항  
　A. 적용 해제 = 복사본 영구 삭제  
　B. 라이브러리 원본에는 영향 없음  


**1.9.3.** API 명세 — 파트너 게임 프리셋  


**1.9.3.1.** 프리셋 목록 조회 API  

1: 엔드포인트  
　A. `GET /api/v1/partner/game/presets?scope=PARTNER`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답 JSON  

```json
{
  "presets": [
    {
      "presetId": "ps_001",
      "name": "기본 구성",
      "savedAt": "2026-01-20",
      "rewardCount": 4,
      "isComplete": true,
      "items": [
        {
          "sourceRewardId": "sr_100",
          "rewardName": "10% 할인 쿠폰",
          "rank": 1,
          "probability": 5,
          "quantity": 100,
          "exists": true
        }
      ],
      "blank": {
        "enabled": true,
        "probability": 30,
        "message": "다음 기회에!"
      }
    }
  ],
  "limit": 1,
  "used": 1
}
```  

3: 응답 필드  
　A. `presets[].isComplete`: 모든 참조 리워드가 라이브러리에 존재하면 true  
　B. `presets[].items[].exists`: 해당 sourceRewardId가 라이브러리에 존재 여부  
　C. `limit`: 플랜별 저장 한도(베이직 1, 플러스 2, 프리미엄 4)  


**1.9.3.2.** 프리셋 저장 API  

1: 엔드포인트  
　A. `POST /api/v1/partner/game/presets`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "scope": "PARTNER",
  "name": "기본 구성",
  "items": [
    {
      "sourceRewardId": "sr_100",
      "rank": 1,
      "probability": 5,
      "quantity": 100
    }
  ],
  "blank": {
    "enabled": true,
    "probability": 30,
    "message": "다음 기회에!"
  }
}
```  

3: 응답  
　A. 성공: `{ "presetId": "ps_002", "saved": true }`  
　B. 한도 초과: `{ "error": "PRESET_LIMIT_EXCEEDED", "limit": 1 }`  
　C. 절대 유효기간 리워드 자동 제외 시: `{ "presetId": "ps_002", "saved": true, "excludedCount": 1, "excludedRewards": ["sr_300"] }`  


**1.9.3.3.** 프리셋 적용 API  

1: 엔드포인트  
　A. `POST /api/v1/partner/game/{gameId}/presets/{presetId}/apply`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답  
　A. 성공: `{ "applied": true, "appliedRewardCount": 4 }`  
　B. 불완전 프리셋: `{ "applied": true, "appliedRewardCount": 3, "missingCount": 1, "warning": "INCOMPLETE_PRESET" }`  
　C. 적용 시 sourceRewardId 기반으로 라이브러리에서 새 복사본 생성  


**1.9.3.4.** 프리셋 삭제 API  

1: 엔드포인트  
　A. `DELETE /api/v1/partner/game/presets/{presetId}`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답  
　A. 성공: `{ "deleted": true }`  


**1.9.4.** API 명세 — 광고주 게임  


**1.9.4.1.** 광고주 게임 참여 상태 조회 API  

1: 엔드포인트  
　A. `GET /api/v1/partner/advertiser-game/participation`  
　B. 인증: Bearer Token (파트너 세션)  

2: 응답 JSON  

```json
{
  "enabled": true,
  "rewardPool": {
    "count": 3,
    "totalProbability": 100,
    "rewards": [
      {
        "activeRewardId": "ar_adv_001",
        "sourceRewardId": "sr_100",
        "name": "500원 할인 쿠폰",
        "type": "COUPON",
        "probability": 50,
        "expiryType": "RELATIVE",
        "expiryDays": 14
      }
    ]
  },
  "campaigns": [
    {
      "campaignId": "c_001",
      "campaignName": "신제품 런칭 이벤트",
      "advertiserName": "ABC 브랜드",
      "period": "2026-01-01 ~ 2026-03-31",
      "status": "ACTIVE"
    }
  ]
}
```  

3: 응답 필드  
　A. `enabled`: 7등 리워드 참여 ON/OFF  
　B. `rewardPool`: 7등 리워드 풀 현재 구성  
　C. `campaigns`: 연결된 광고주 캠페인 목록(읽기 전용)  


**1.9.4.2.** 광고주 게임 참여 토글 API  

1: 엔드포인트  
　A. `PUT /api/v1/partner/advertiser-game/participation`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "enabled": false
}
```  

3: 응답  
　A. 성공: `{ "enabled": false, "updatedAt": "2026-01-25T10:30:00" }`  

4: 유의사항  
　A. OFF 시 7등 리워드 풀·프리셋 데이터 유지  
　B. 모든 연결 캠페인에 일괄 적용  


**1.9.4.3.** 7등 리워드 풀 업데이트 API  

1: 엔드포인트  
　A. `PUT /api/v1/partner/advertiser-game/reward-pool`  
　B. 인증: Bearer Token (파트너 세션)  

2: 요청 Body  

```json
{
  "rewards": [
    {
      "activeRewardId": "ar_adv_001",
      "probability": 50
    },
    {
      "activeRewardId": null,
      "sourceRewardId": "sr_200",
      "probability": 50
    }
  ]
}
```  

3: 응답  
　A. 성공: `{ "updated": true, "poolCount": 2 }`  
　B. 확률 합계 오류: `{ "error": "PROBABILITY_SUM_INVALID" }`  

4: 유의사항  
　A. 꽝 없음(100% 리워드 당첨)  
　B. 최대 6개  


**1.9.4.4.** 광고주 게임 프리셋 관리 API  

1: 프리셋 조회  
　A. `GET /api/v1/partner/game/presets?scope=ADVERTISER`  
　B. 응답 구조: 1.9.3.1.과 동일(scope 필터)  

2: 프리셋 저장  
　A. `POST /api/v1/partner/game/presets` + `scope: "ADVERTISER"`  
　B. 저장 항목: sourceRewardId + probability (등수·수량·꽝 없음)  
　C. 한도: 베이직 1, 플러스 2, 프리미엄 4 (파트너 프리셋과 별도 카운트)  

3: 프리셋 적용  
　A. `POST /api/v1/partner/advertiser-game/presets/{presetId}/apply`  

4: 프리셋 삭제  
　A. `DELETE /api/v1/partner/game/presets/{presetId}`  


**1.9.5.** 컴포넌트 구현 참고  


**1.9.5.1.** 탭 UI 분기  

1: 페이지 로드 시 `GET /partner/game/current` + `GET /partner/advertiser-game/participation` 병렬 호출  
2: 탭 전환 시 추가 API 호출 없음(초기 로드 데이터 사용, 반영 시만 재호출)  

**1.9.5.2.** 1.3. 편집기 상태 관리  

1: 서버 데이터(GET rewards)를 로컬 상태에 복사  
2: 편집 중 변경사항은 로컬에서만 유지  
3: [게임에 반영] 클릭 시 PUT rewards 호출 → 성공 시 로컬 상태 갱신  
4: 탭 전환·페이지 이동 시 미저장 변경 감지 → 확인 모달  

**1.9.5.3.** 복사본 ID 관리  

1: `activeRewardId`: 게임 적용 복사본의 고유 ID (서버 생성)  
2: `sourceRewardId`: 원본 라이브러리 리워드 ID  
3: 새 리워드 추가 시: `activeRewardId = null`, `sourceRewardId` 필수 → 서버가 복사본 생성 + activeRewardId 반환  
4: 기존 리워드 수정 시: `activeRewardId` 필수  

**1.9.5.4.** 프리셋 완전성 표시  

1: `isComplete === false` → 프리셋 카드에 경고 아이콘 + "불완전" 배지  
2: `items[].exists === false` → 해당 리워드 취소선 처리 + 비활성 상태  
3: 불완전 프리셋 적용 시 유효 항목만 적용 → 확률 합계 미달 안내  


**1.9.6.** 에러 처리  


**1.9.6.1.** 에러 코드  

1: GAME_001: 게임 조회 실패  
2: GAME_002: 게임 이미 존재 (중복 생성 방지)  
3: GAME_003: 유형 변경 횟수 초과  
4: GAME_004: 확률 합계 불일치 (≠ 100%)  
5: GAME_005: 프리셋 저장 한도 초과  
6: GAME_006: 참조 리워드 미존재 (라이브러리에서 삭제됨)  
7: GAME_007: 광고주 게임 참여 상태 변경 실패  

**1.9.6.2.** 공통  

1: 인증 실패: 401, 로그인 페이지로 유도  
2: 5xx: "일시적인 오류가 발생했습니다" + 재시도 안내  


• 참조: 1.0.~1.8. 게임 설정 전 섹션, 7-2-8-3 > 3.1. 리워드, 7-2-7-2. 코인 관리 > 2.9. 개발자 인터랙션 명세  
