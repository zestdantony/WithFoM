<!-- WF:DOC=DEV -->
**6.6.** 개발자 인터랙션 명세  


**6.6.1.** 데이터 연동 방식  

**6.6.1.1.** REST API 기반  
1: 연동 방식  
　A. 페이지 로드 시 REST API 호출로 데이터 조회  
　B. 리워드 발행/사용 시 이벤트 기반 갱신  
2: 갱신 조건  
　A. 쿠폰 발행/사용 완료 시  
　B. 포인트 발급/사용 완료 시  
　C. 스탬프 적립/혜택 발급 완료 시  

**6.6.1.2.** WebSocket 연결 (선택적)  
1: 실시간 갱신 필요 시  
　A. wss://api.withfom.com/partner/dashboard/realtime  
　B. 이벤트: dashboard.reward_updated  
2: 연결 조건  
　A. 복합형 파트너 (오더 + 리워드 모두 사용)  
　B. 리워드 사용 빈도가 높은 매장  


**6.6.2.** API 명세  

**6.6.2.1.** 리워드 현황 조회 (대시섹션용)  
1: 엔드포인트  
　A. GET /api/v1/partner/dashboard/reward-summary  
2: 요청 파라미터  
　A. date (optional): 조회 기준일 (기본값: 오늘)  
3: 응답 구조  

```json
{
  "couponSummary": {
    "todayIssued": 8,
    "monthlyTotalIssued": 1250,
    "todayUsed": 5,
    "monthlyTotalUsed": 890,
    "usageRate": 71.2,
    "isEnabled": true
  },
  "pointSummary": {
    "todayIssued": 500,
    "monthlyTotalIssued": 125000,
    "todayUsed": 320,
    "monthlyTotalUsed": 89500,
    "remainingTotal": 35500,
    "isEnabled": true
  },
  "stampSummary": {
    "todayAccumulated": 45,
    "monthlyTotalAccumulated": 8750,
    "todayBenefitIssued": 3,
    "monthlyTotalBenefitIssued": 580,
    "completionRate": 68.5,
    "isEnabled": true
  },
  "currentMonth": "2026-01",
  "displayMonth": "2026년 1월",
  "lastUpdatedAt": "2026-01-28T14:35:00Z"
}
```


**6.6.2.2.** 쿠폰 상세 조회  
1: 엔드포인트  
　A. GET /api/v1/partner/dashboard/reward-summary/coupon  
2: 요청 파라미터  
　A. startDate: 조회 시작일  
　B. endDate: 조회 종료일  
3: 응답 구조  

```json
{
  "couponDetail": {
    "periodIssued": 42,
    "periodUsed": 28,
    "usageRate": 66.7,
    "couponTypes": [
      {
        "typeId": "discount_10",
        "typeName": "10% 할인 쿠폰",
        "issued": 20,
        "used": 15
      },
      {
        "typeId": "free_drink",
        "typeName": "음료 무료 쿠폰",
        "issued": 12,
        "used": 8
      }
    ],
    "dailyBreakdown": [
      { "date": "2026-01-28", "issued": 8, "used": 5 },
      { "date": "2026-01-27", "issued": 10, "used": 7 }
    ]
  }
}
```


**6.6.3.** 컴포넌트 상태 관리  

**6.6.3.1.** 데이터 상태 정의  
1: 로딩 상태 (loadingState)  
　A. idle: 초기 상태  
　B. loading: 데이터 로드 중  
　C. success: 데이터 로드 완료  
　D. error: 데이터 로드 실패  
2: 기능 활성화 상태 (enabledState)  
　A. enabled: 해당 리워드 기능 활성화  
　B. disabled: 해당 리워드 기능 비활성화  
　C. pending: 활성화 진행 중  

**6.6.3.2.** 리워드 타입별 처리  

```javascript
const RewardSummarySection = ({ rewardConfig }) => {
  const { couponEnabled, pointEnabled, stampEnabled } = rewardConfig;
  
  return (
    <Section>
      <CouponCard enabled={couponEnabled} />
      <PointCard enabled={pointEnabled} />
      <StampCard enabled={stampEnabled} />
    </Section>
  );
};
```


**6.6.3.3.** 비활성화 카드 처리  

```javascript
const DisabledRewardCard = ({ type, onEnable }) => (
  <Card onClick={onEnable} disabled>
    <Icon name={`${type}-disabled`} />
    <Text>{getEnableMessage(type)}</Text>
    <Button variant="link">기능 활성화</Button>
  </Card>
);

const getEnableMessage = (type) => {
  switch (type) {
    case 'coupon': return '쿠폰 기능을 활성화하세요';
    case 'point': return '포인트 기능을 활성화하세요';
    case 'stamp': return '스탬프 기능을 활성화하세요';
    default: return '';
  }
};
```


**6.6.4.** 데이터 갱신 처리  

**6.6.4.1.** 이벤트 기반 갱신  

```javascript
const handleRewardUpdate = (event) => {
  if (event.type === 'dashboard.reward_updated') {
    const { rewardType, action, amount } = event.data;
    
    switch (rewardType) {
      case 'coupon':
        updateCouponSummary(action, amount);
        break;
      case 'point':
        updatePointSummary(action, amount);
        break;
      case 'stamp':
        updateStampSummary(action, amount);
        break;
    }
  }
};
```


**6.6.4.2.** 일일 초기화 처리  

```javascript
const handleDailyReset = (event) => {
  if (event.type === 'dashboard.daily_reset') {
    // 오늘 데이터 초기화 (영업 오픈 시간 기준)
    setRewardSummary(prev => ({
      ...prev,
      couponSummary: { ...prev.couponSummary, todayIssued: 0, todayUsed: 0 },
      pointSummary: { ...prev.pointSummary, todayIssued: 0, todayUsed: 0 },
      stampSummary: { ...prev.stampSummary, todayAccumulated: 0, todayBenefitIssued: 0 }
    }));
  }
};

const handleMonthlyReset = (event) => {
  if (event.type === 'dashboard.monthly_reset') {
    // 월별 토탈 데이터 초기화 및 월 표기 변경 (매월 1일 영업 오픈 시간)
    setRewardSummary(prev => ({
      ...prev,
      couponSummary: { ...prev.couponSummary, monthlyTotalIssued: 0, monthlyTotalUsed: 0, usageRate: 0 },
      pointSummary: { ...prev.pointSummary, monthlyTotalIssued: 0, monthlyTotalUsed: 0 },
      stampSummary: { ...prev.stampSummary, monthlyTotalAccumulated: 0, monthlyTotalBenefitIssued: 0, completionRate: 0 },
      currentMonth: event.data.newMonth,
      displayMonth: event.data.displayMonth  // 예: "2026년 2월"
    }));
  }
};
```


**6.6.5.** 에러 처리  

**6.6.5.1.** 에러 코드 정의  
1: 에러 코드  
　A. RWD_001: 리워드 데이터 조회 실패  
　B. RWD_002: 리워드 기능 미활성화  
　C. RWD_003: 권한 없음  
　D. RWD_004: 서버 오류  

**6.6.5.2.** 에러 처리 방식  
1: API 호출 실패  
　A. 자동 재시도: 3회, 간격 2초  
　B. 실패 시 에러 상태 표시  
　C. "데이터를 불러오는 데 실패했습니다" 메시지  
　D. [새로고침] 버튼 제공  


**6.6.6.** 접근성 요구사항  

**6.6.6.1.** ARIA 레이블  
1: 섹션 영역  
　A. role="region"  
　B. aria-label="리워드 현황 섹션"  
2: 카드 영역  
　A. role="button" (클릭 가능)  
　B. aria-label="쿠폰: 오늘 발행 8건, 사용 5건, 사용률 71.2%"  
3: 프로그레스 바  
　A. role="progressbar"  
　B. aria-valuenow="{현재값}"  
　C. aria-valuemin="0"  
　D. aria-valuemax="100"  

**6.6.6.2.** 키섹션 내비게이션  
1: Tab 순서  
　A. 섹션 제목 → 전체 보기 링크 → 쿠폰 카드 → 포인트 카드 → 스탬프 카드  
2: 단축키  
　A. Enter: 선택된 카드 클릭  
　B. Space: 선택된 카드 클릭  


**6.6.7.** 성능 최적화  

**6.6.7.1.** 렌더링 최적화  
1: 컴포넌트 구조  
　A. React.memo 적용으로 불필요한 리렌더링 방지  
　B. 각 카드 컴포넌트 독립적으로 업데이트  
2: 프로그레스 바  
　A. CSS transition으로 부드러운 애니메이션  
　B. 값 변경 시만 리렌더링  

**6.6.7.2.** 데이터 캐싱  
1: 캐싱 전략  
　A. 대시섹션 데이터: 5분 캐시  
　B. 리워드 발행/사용 이벤트 발생 시 캐시 무효화  
　C. 페이지 이탈 후 복귀 시: 캐시 데이터 표시 → 백그라운드 갱신  


**6.6.8.** 초기화 처리  

**6.6.8.1.** 일일 초기화 로직  
1: 서버 트리거  
　A. 매일 영업 오픈 시간 기준으로 서버에서 자동 초기화  
　B. 24시간 영업장은 자정(00:00) 기준으로 초기화  
2: 초기화 대상  
　A. 오늘 발행/사용 건수 → 0으로 리셋  
　B. 오늘 적립/혜택 발급 → 0으로 리셋  
3: 유지 대상  
　A. 토탈 데이터 (월별)  
　B. 사용률/완성률 통계  

**6.6.8.2.** 월별 초기화 로직  
1: 서버 트리거  
　A. 매월 1일 영업 오픈 시간에 토탈 데이터 초기화  
2: 초기화 대상  
　A. 토탈 발행/사용 건수 → 0으로 리셋  
　B. 토탈 적립/혜택 발급 → 0으로 리셋  
　C. 사용률/완성률 통계 → 0으로 리셋  
3: 유지 대상  
　A. 잔여 포인트 (누적, 월별 초기화 대상 아님)  
　B. 전월 데이터는 별도 저장  


• 참조: 7-2-8. 리워드•스탬프 > 개발자 명세
